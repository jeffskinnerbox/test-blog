View these
Introduction to Bluetooth low energy and Bluetooth low energy development (video tutorial) - https://devzone.nordicsemi.com/tutorials/37/
Tutorials - https://devzone.nordicsemi.com/tutorials/

* [Bluetooth Commands](http://www.raspberry-projects.com/pi/pi-operating-systems/raspbian/bluetooth/bluetooth-commands)
* [Bluetooth Devices Can Now Be Controlled From The Web Through Node.js](https://arc.applause.com/2016/02/12/bluetooth-gateway-navible-node-js/)
* [“Everything is Better with Bluetooth”:  Add Your Own Custom Bluetooth LE to Your Next Project](https://www.allaboutcircuits.com/projects/add-custom-bluetoothle-to-your-next-project/?utm_source=All+About+Circuits+Members&utm_campaign=14090e08e3-EMAIL_CAMPAIGN_2017_07_06&utm_medium=email&utm_term=0_2565529c4b-14090e08e3-270523833/)
* [Troubleshooting Tools for Your Next Bluetooth LE Project: Ubertooth and the Nordic nRF Sniffer](https://www.allaboutcircuits.com/projects/troubleshooting-tools-bluetooth-LE-project-ubertooth-Nordic-nRF-sniffer/?utm_source=All+About+Circuits+Members&utm_campaign=cb0049211b-EMAIL_CAMPAIGN_2017_07_19&utm_medium=email&utm_term=0_2565529c4b-cb0049211b-270523833/)
* [nRF52832-MDK Documentation](https://wiki.makerdiary.com/nrf52832-mdk/)

* [The Wireless Protocols Tying Together the Internet of Things](https://sub.allaboutcircuits.com/white-papers/silicon-labs/The_Wireless_Protocols_Tying_together_the_Internet_of_Things.pdf)
* [Bluetooth 5, Refined for the IoT](https://sub.allaboutcircuits.com/white-papers/silicon-labs/Whitepaper_Bluetooth-5-Refined-for-the-IoT_FINAL.pdf)

* [Bluetooth Compatibility Guide](https://www.kohls.com/media/digital/ecom/pdfs/pdf/Bluetooth_Compatibility_Guide_May_2015.pdf)
* [Getting Started with Bluetooth Low Energy Development](http://cdn2.hubspot.net/hubfs/1961165/eBooks/NordicSemi_eBook_Bluetooth_Low_Energy_development.pdf?__hssc=8439722.21.1498183911767&__hstc=8439722.c9dd4b6d976bf65845653762e20b9b8e.1497729363306.1498098124982.1498183911767.10&__hsfp=3204778181&hsCtaTracking=0c610996-d8ee-40c9-82f4-b4db77681f9b%7Cfe75fcbd-83e6-4bfd-94b3-1c9084f36d86)
* [Bluetooth Tutorial (PowerPoint Presentation)](http://sna.csie.ndhu.edu.tw/~cnyang/PDF/bt_tut.pdf)
* [tutorials written by Nordic employees](https://devzone.nordicsemi.com/tutorials/)

* [Beginning BLE Experiments And Making Everything Better](https://hackaday.com/2018/08/03/beginning-ble-experiments-and-making-everything-better/#more-318458)


Need to define BR/EDR some place
* Bluetooth Basic Rate/Enhanced Data Rate (BR/EDR) -  is typically used for relatively short-range, continuous wireless connection such as streaming audio to headsets.
* Bluetooth low energy (LE) - is designed to use short bursts of longer-range radio connection, making it ideal for Internet of Things (IoT) applications that don’t require continuous connection. These apps can often run on just one coin cell and still have a relatively long battery life.
* https://electronics.stackexchange.com/questions/258836/bluetooth-dual-mode-br-edr-le
* https://engineering.stackexchange.com/questions/12311/what-is-the-difference-between-bluetooth-low-energy-and-bluetooth-br-edr-in-park
* http://www.skylabmodule.com/what-is-the-difference-between-bluetooth-br-edr-and-bluetooth-smart/


###########################################################



Getting a firm understanding of Bluetooth, in all of it intricacies, is a heavy lift.
The ambition of this write-up is to take you on that journey,
but inevitably, your going to need additional sources to fully absorb the ins & outs of Bluetooth.
Bellow are some suggested documents and videos to study along with this write-up:

* Initial reading list to get you grounded in Bluetooth concepts and capabilities:
    * [Bluetooth Basics](https://learn.sparkfun.com/tutorials/bluetooth-basics/all)
    * [Why Bluetooth Smart is perfect for M2M: Part 1](https://www.ecnmag.com/blog/2014/12/why-bluetooth-smart-perfect-m2m)
    * [How to use Bluetooth Smart in industrial lighting: Part 2](https://www.ecnmag.com/blog/2014/12/how-use-bluetooth-smart-industrial-lighting)
    * [Connecting machinery to the IoT: Part 3](https://www.ecnmag.com/blog/2014/12/connecting-machinery-iot)
    * [iBeacons Explained: 10 Things About iBeacons You Need to Know](https://www.youtube.com/watch?v=L44m7otNI7o&t=4s)
    * [How you can replace wires with Bluetooth Smart: Part 4](https://www.ecnmag.com/blog/2014/12/how-you-can-replace-wires-bluetooth-smart)
    * [Why Beacon is the next big thing in wireless: Part 5](https://www.ecnmag.com/blog/2014/12/why-beacon-next-big-thing-wireless)
    * [The key to using Bluetooth Smart in asset tracking: Part 6](https://www.ecnmag.com/blog/2015/01/key-using-bluetooth-smart-asset-tracking)
* Some excellent technical level introduction to Bluetooth:
    * [Introduction to Bluetooth Smart](https://www.csrsupport.com/download/49793/CS-327738-RP-2-Training%20and%20Tutorials%20-%20Introduction%20to%20Bluetooth%20Smart.pdf)
    * [Bluetooth Training: Developer Resources](https://www.bluetooth.com/develop-with-bluetooth/developer-resources-tools/developer-training-videos)
    * [Getting Started with Bluetooth Low Energy](https://www.youtube.com/watch?v=JpIooW_xHIU)
    * [Advanced BLE System Design](https://tinkerer.us/qualifications/Cypress/Advanced_BLE_System_Design.pdf)
    * [Introduction to Bluetooth low energy and Bluetooth low energy development (video tutorial)](https://devzone.nordicsemi.com/tutorials/37/)
    * Raspberry Pi & Bluetooth LE with Tony D! @adafruit #LIVE
[Part 1](https://www.youtube.com/watch?v=5fQR2PHMDWE),
[Part 2](https://www.youtube.com/watch?v=sP0MjQDv2N4),
[Part 3](https://www.youtube.com/watch?v=wKZaYKavJsQ)
    * Application Oriented Introduction to Bluetooth Low Energy:
[Part 1](https://devzone.nordicsemi.com/tutorials/37/),
[Part 2](https://devzone.nordicsemi.com/tutorials/37/).
    * BLE v4.2: Creating Faster, More Secure, Power-Efficient Designs
[Part 1](http://www.electronicdesign.com/communications/ble-v42-creating-faster-more-secure-power-efficient-designs-part-1),
[Part 2](http://www.electronicdesign.com/communications/ble-v42-creating-faster-more-secure-power-efficient-designs-part-2),
[Part 3](http://www.electronicdesign.com/communications/ble-v42-creating-faster-more-secure-power-efficient-designs-part-3),
[Part 4](http://www.electronicdesign.com/communications/ble-v42-creating-faster-more-secure-power-efficient-designs-part-4),
[Part 5](http://www.electronicdesign.com/communications/ble-v42-creating-faster-more-secure-power-efficient-designs-part-5)

# What is Bluetooth
[!bluetooth-logo](http://cdn.makeuseof.com/wp-content/uploads/2015/06/bluetooth-combo-wordmark-640x300.png?x59455)
It seems like where ever you turn some new product features Bluetooth technology,
but what does that mean?
Basically, Bluetooth is a high-speed,
low-power wireless link for transmitting voice and data.
Class 2 Bluetooth technology functions as a 10-meter personal bubble
that supports the simultaneous transmission of both voice and data information for more than one device.
Up to eight data devices can be connected in a single piconet,
with up to 10 piconets existing within the 10-meter bubble.
Not only that, but each piconet also supports up to three simultaneous full duplex voice devices.
Types of Bluetooth devices include dongles, headsets, radios, and PC cards, among other products.

Bluetooth is one of the mainstays of the gadget world,
allowing devices to communicate easily over short distances.
It does this without the complexity and power requirements of WiFi.
In 1998 the [Bluetooth Special Interest Group (SIG)][20] was formed with five companies.
and the Bluetooth 1.0 Specification was released in 1999.

Bluetooth first appeared as a consumer technology in 2000
and it is a 2.4GHz wireless communication protocol for connecting devices
It's slower than WiFi but is often simpler to set up,
and is usually preferred for device-to-device communications.
Bluetooth serves as an excellent protocol for wirelessly transmitting relatively
small amounts of data over a short range (less than 100m).
It’s perfectly suited as a wireless replacement for serial communication interfaces.

Bluetooth networks use a master/slave (sometimes called controller/peripheral) model
[piconet][62] to control when and where devices can send data.
A single master device can be connected to up to seven different slave devices.
Any slave device in the piconet can only be connected to a single master,
and slaves are only allowed to transmit to and receive from their master.
Starting in Bluetooth v4.1, a device can be simultaneous master and a slave.

Every Bluetooth device has a unique 48-bit address,
commonly abbreviated `BD_ADDR`
The most-significant half (first 24 bits) of the address is an organization unique identifier (OUI), which identifies the manufacturer. The lower 24-bits are the more unique part of the address.
This address should be visible on most Bluetooth devices
and will sometimes be referred to as the “MAC NO” or "MAC ADDRESS".

There are essentially two strains of Bluetooth,
the older legacy or classic strain that encompasses versions 1.0 through 3.0 (including EDR).
The other strain is the low-energy Bluetooth that includes versions 4.0, 4.1, and 4.2.
The low-energy version uses a different radio technology than the classic strain.
It employs frequency-hopping spread spectrum (FHSS) over the 2.4- to 2.483-GHz spectrum,
but uses 40 2-MHz-wide channels rather than the 79 1-MHz channels of classic Bluetooth.
Max data rate is 1 Mb/s.
Most of the newer Bluetooth chips actually contain both types of radios.

Bluetooth version 5 is esentually an extention to the low-energy strain of Bluetooth:

* It bumps the data rate up to 2 Mb/s but still uses the same GFSK modulation.
The higher data rate decreases the transmission time of the messages sent to better conserve power.
* The basic power output level is 0 dBm or 1 mW, but higher-power classes of Bluetooth can also be used.
Low-energy Bluetooth has a nominal range of 10 to 30 meters.
* Bluetooth 5 extends this to the 30- or 50-meter range.
The new version 5 ups the payload capacity of it packets to the 31 to 255 octet range,
and that means fewer transmissions and less broadcast time.
* Bluetooth 5 also incorporates features to better minimize interference.
Remember Bluetooth shares the 2.4-GHz ISM band with Wi-Fi, ZigBee, and a bunch of other wireless devices,
so there’s a greater likelihood for interference. The new features detect and prevent interference at the band edges.

## Bluetooth Networking
Bluetooth is more that just a radio.

* Piconet: up to 7 devices can be actively connected to a master station
* Additional devices can be connected in a parked or hold mode
* Piconets can form Scatter Nets for almost unlimited connectivity

A [piconet][62] consists of two or more devices, using Bluetooth technology protocols,
occupying the same physical channel (synchronized to a common clock and hopping sequence).
It allows one master device to interconnect with up to seven active slave devices.
Up to 255 further slave devices can be inactive, or parked,
which the master device can bring into active status at any time,
but an active station must go into parked first.

A [scatternet][61] is two or more piconets connected by a common device.
While scatternet topology appeared to stimulate [some interest][90],
it appears that scatternet's have been mainly a research topic with few,
if any, real world implementations.

## Bluetooth Protocols
In many ways, the word "Bluetooth" is like the word "Internet"
because it encompasses a wide range of subjects.
Like the Internet's Ethernet or WiFi,
Bluetooth defines a lot of physical on-the-wire stuff like on which
radio frequencies to transmit and how to modulate and demodulate signals.
Similar the Internet's Voice-over-IP protocols,
Bluetooth also describes how to transmit audio between devices.
But Bluetooth also specifies everything in between,
resulting thousands of pages of specifications.
So like TCP/IP, Bluetooth uses a variety of protocols.
Core protocols are defined by the Bluetooth SIG but additional protocols
have been adopted from other standards bodies.

* [Wikipedia](https://en.wikipedia.org/wiki/List_of_Bluetooth_protocols)
gives an overview of the core protocols and those adopted protocols that are widely used.
* [Bluetooth protocols explained](https://www.crutchfield.com/S-03U0dPbI1WZ/learn/abcs-bluetooth-in-the-car.html)
is a low tech explanation of some protocols used to support popular use cases.

## Connecting, Paring, and Bonding
It is important to understanding how connecting, pairing, and bonding are related in Bluetooth LE:

* **Connecting** is the act of establishing a communication link.
No pairing or bonding is required to communicate over Bluetooth LE.
* **Pairing** is the act of exchanging keys after connection,
typically to set up and maintain an encrypted connection.
The Bluetooth 4.0 Specification state:
"A procedure that authenticates two devices and creates a common link key
that can be used as a basis for a trusted relationship or a (single) secure connection.
Pairing usually requires an authentication process where a user must validate the connection between devices.
There are different types of authentication.
Sometimes pairing is a simple “Just Works” operation,
where the click of a button is all it takes to pair
(this is common for devices with no UI, like headsets).
Other times pairing involves the entering of a common PIN code on each device.
* **Bonding** is the act of storing the exchanged keys after pairing,
typically to re-establish an encrypted connection without needing to exchange these keys again.
In the words of the Bluetooth 4.0 Specification:
"Bonding allows two connected devices to exchange and store security and
identity information to create a trusted relationship".
When devices pair up, they share their addresses, names, and profiles, and usually store them in memory.
The also share a common secret key, which allows them to bond whenever they’re together in the future.
Bonded devices automatically establish a connection whenever they’re close enough.

This whole pairing and bonding process is ladened with security and privacy procedures.
To better understand this, [read this article][83] and [this][84].
Also read the "Bluetooth Security / Privacy" section below.

## Connection Process
Creating a Bluetooth connection between two devices involves three progressive states:

1. **Inquiry** – If two Bluetooth devices know absolutely nothing about each other,
one must run an inquiry to try to discover the other.
One device sends out the inquiry request,
and any device listening for such a request will respond with its address,
and possibly its name and other information.
1. **Paging (Connecting)** – Paging is the process of forming a connection between two Bluetooth devices.
Before this connection can be initiated, each device needs to know the address of the other
(found in the inquiry process).
1. **Connection** – After a device has completed the paging process, it enters the connection state.
While connected, a device can either be actively participating or
it can be put into a low power sleep mode.
    * **Active Mode** – This is the regular connected mode, where the device is actively transmitting or receiving data.
    * **Sniff Mode** – This is a power-saving mode, where the device is less active. It’ll sleep and only listen for transmissions at a set interval (e.g. every 100ms).
    * **Hold Mode** – Hold mode is a temporary, power-saving mode where a device sleeps for a defined period and then returns back to active mode when that interval has passed. The master can command a slave device to hold.
    * **Park Mode** – Park is the deepest of sleep modes. A master can command a slave to “park”, and that slave will become inactive until the master tells it to wake back up.

## Pairing Bluetooth Devices with NFC
Pairing sounds fairly simple, but the devil’s in the details.
It takes time to discover devices.
The device names are usually quite difficult to interpret
and it’s difficult to recognize one from another if multiple devices are within range.
And that automatic pairing after the first time doesn’t really help
if you want to share the headphones with family and friends when it’s always connected to your music player.

This is where [Near Field Communication (NFC)][60] comes into play.
By the numbers, it’s a modest technology,
transmitting only a few hundred kilobits per second
and barely reaching farther than a couple of centimeters.
However, it provides exactly what is needed: the equivalent of plugging in a cable.
The strict proximity that NFC requires means there are exactly two devices
you want to connect and you want to connect them now.
The amount of data that can be transferred in a second or
so is more than sufficient to provide all the technical details they need.

NFC is a technology that enables Bluetooth devices to establish
wireless communication with each other by simply touching the devices together.
The NFC Forum and the Bluetooth Special Interest Group (SIG) collaborated
to produce an application document titled
[NFC Forum Bluetooth Secure Simple Pairing Using NFC (NFCForum-AD-BTSSP_1_1)][47].

## Bluetooth Adaptor vs Device
A Bluetooth Device Address (`BD_ADDR`)
is a globally unique value assigned to each Bluetooth adapter by the manufacturer.
The `BD_ADDR` is what popularly known as a static address,
and not broadcasted like a [media access control address (MAC address)][86].
The piconet hopping sequence is derived from the `BD_ADDR`,
and give that its unique, this keeps piconets from interfering with each other.

The MAC address is created as per the IEEE 802-2001 standards.

* http://bnap.opensecurityresearch.com/readme.html
* https://macaddresschanger.com/what-is-bluetooth-address-BD_ADDR

## Bluetooth Power Classes
The transmit power, and therefore range,
of a Bluetooth module is defined by its power class.
There are three defined classes of power,
but some modules are only able to operate in one power class,
while others can vary their transmit power.

| Device Class | Transmit Power |   Intended Range     |
|:------------:|:--------------:|:--------------------:|
| Class 1      | 100 mW, 20 dBm | 100 meters, 328 feet |
| Class 2      | 2.5 mW, 4 dBm  | 10 meters, 33 feet   |
| Class 3      | 1 mW, 0 dBm    | less than 10 meters  |

Bluetooth defines three main power classes used by the devices. Power control is used to keep the radiation within the limit so that system works efficiently without interfering with the neighbour bluetooth devices. The power control algorithm is designed between master and slave devices using link management protocol.

* http://bluetoothinsight.blogspot.com/2008/01/bluetooth-power-classes.html

## BLE Modes of Operation
There are three main software levels in the architecture of a BLE device:

* **Application:** the application interfacing with the stack and implementing the specific user applications
* **Host:** high level layer of the protocol stack.
* **Controller:** low level layer of the protocol stack including the physical layer

The HCI (Host Controller Interface) is a standard communications protocol
defined by the Bluetooth SIG to allow developers to use multiple processors from different vendors
(one as a radio device, and another as the main processor for implementing the application).

Two main modes in BLE:

* **Broadcasting:** a broadcaster device initially advertises its presence
and an observer device will discover these broadcasters by scanning the surroundings.
Some devices stay in this phase, such as Apple iBeacons and Google Eddystone devices.
This allows the broadcasting device to make itself visible to
any observer and advertise a limited amount of useful info.
* **Connection:** starts with a device advertising (Peripheral/Slave) and another (Central/Master)
scanning the specific advertising channels.
The connection is then initiated by the central device.
This mode connects the two devices allowing data transfer and a private communications channel
between the two (this is the typical case outside of beacon devices).
Once a connection is established, the end device (the embedded device)
can turn off the radio leading to a lower power consumption.

## Bluetooth Profiles
Bluetooth [profiles][28] are additional protocols that build upon the basic Bluetooth
standard to more clearly define what kind of data a Bluetooth module is transmitting.
While Bluetooth specifications define how the technology *works*, profiles define how it’s *used*.
The Bluetotoh profiles can be characterized as:

* **Generic profiles:** these are the generic profiles defined by the Bluetooth spec.
They lay out the fundamentals for all BLE devices.
    * GATT (Generic Attribute Profile): a basic data model that allows devices to discover, write, and read elements.
    * GAP (Generic Access Profile): layer responsible for managing connections, advertisements, discovery and security features.
* **Use-case profiles:** these are adopted by the Bluetooth SIG and defining common behavior
to make implementation simple for specific use-cases.
Examples: Glucose profile, Heart Rate Monitor profile, Proximity profile.

The profile(s) a Bluetooth device supports determines what application it’s geared towards.
A hands-free Bluetooth headset, for example, would use headset profile (HSP),
while a Nintendo Wii Controller would implement the human interface device (HID) profile.
For two Bluetooth devices to be compatible, they must support the same profiles.

[**GAP (Generic Access Profile)**][72] controls connections and advertising in Bluetooth.
It determines how two devices can (or can't) interact with each other
and defines various roles for devices:

* **Broadcaster devices** are optimised for transmitter only applications;
active transmitter sending data to any device that is listening
* **Observer devices** are optimised for receiver only applications;
passive scanner looking for broadcasts
* **Peripheral devices** (slave) are small, low power, resource
contrained devices that advertise to connect to a much more powerful central device.
* **Central devices** (master) are usually (but not necessarily) a
mobile phone or tablet with far more processing power and memory.
* **Central vs. peripheral**. This applies to the BLE connection itself.
The device in the central role scans, looking for advertisement,
and the device in the peripheral role makes the advertisement.
* **GATT server vs. GATT client**. This determines how two devices talk to each other
once they've established the connection.

[**GATT (Generic Attribute Profile)**][26]
is a general specification for sending and receiving short pieces
of data known as "attributes" over a BLE link.
All current Low Energy application profiles are based on GATT.
The Bluetooth SIG defines many profiles for Low Energy devices.
A profile is a specification for how a device works in a particular application,
and a device can implement more than one profile.

[**ATT (Attribute Profile)**][26],
also refered to as the GATT/ATT, is used to build the GATT and optimized to run on BLE devices.
To this end, it uses as few bytes as possible.
Each attribute is uniquely identified by a Universally Unique Identifier (UUID),
which is a standardized 128-bit format for a string ID used to uniquely identify information.
The attributes transported by ATT are formatted as characteristics and services.
[Profile][73] doesn't actually exist on the BLE peripheral itself,
it's simple a pre-defined collection of attributes that has been compiled by
either the Bluetooth SIG or by the peripheral designers.

* [**Characteristics**][69] -
A characteristic contains a single value and 0-n descriptors that describe the characteristic's value.
A characteristic can be thought of as a type, analogous to a class.
* **Descriptor** -
Descriptors are defined attributes that describe a characteristic value.
For example, a descriptor might specify a human-readable description,
an acceptable range for a characteristic's value,
or a unit of measure that is specific to a characteristic's value.
* [**Service**][68] -
A service is a collection of characteristics.
For example, you could have a service called "Heart Rate Monitor"
that includes characteristics such as "heart rate measurement."
You can find a list of existing GATT-based profiles and services on [bluetooth.org][27].

GATT comes into play once a dedicated connection is established between two devices,
meaning that you have already gone through the advertising process governed by GAP.
Keep in mind with GATT and connections is that *connections are exclusive*.
What is meant by that is that a BLE peripheral can only be connected to one central device
(a mobile phone, etc.) at a time!
As soon as a peripheral connects to a central device, it will stop advertising itself
and other devices will no longer be able to see it or connect to it until the existing connection is broken.

GATT has a server/client relationship.
The peripheral is known as the **GATT Server**,
which holds the ATT lookup data and service and characteristic definitions,
and the **GATT Client** (the phone/tablet), which sends requests to this server.
All transactions are started by the master device, the GATT Client,
which receives response from the slave device, the GATT Server.

Some of the typical profiles invoked after GAP and GATT are:

* [SPP (Serial Port Profile)][57]
defines the protocols and procedures that shall be used by devices using
Bluetooth for RS232, UART (or similar) serial cable emulation.
* [A2DP (Advanced Audio Distribution Profile)][27]
makes streaming stereo music possible.
* [HID (Human Interface Device Profile)][27]
makes your Bluetooth enabled mice and keyboards work effortlessly.
* [BIP (Basic Imaging Profile)][27]
allows you to send images between devices (other phones, printers, even picture frames).

### GAP Address Types
* **Public address** -
This is a global, fixed address.
It must be registered with the IEEE Registration Authority
and will never change during the lifetime of the device.
* **Random Static address** -
A random static address is simply a random number that can either be generated every time
the device boots up or can stay the same for the lifetime of the device.
But it cannot be changed within a single power cycle of the device.
* **Private Resolvable address** -
These are generated from an identity resolving key (IRK) and a random number,
and they can be changed often (even during the lifetime of a connection)
to avoid the device being identified and tracked by an unknown scanning device.
Only devices that possess the IRK distributed by the device using a private resolvable address
can actually resolve that address, allowing them to identify the device.
* **Private Non-Resolvable address** -
Not very commonly used, a random number that you can change anytime.

* https://devzone.nordicsemi.com/question/43670/how-to-distinguish-between-random-and-public-gap-addresses/

## Bluetooth Security / Privacy
In the 4.0, 4.1, and 4.2 Bluetooth specifications,
noumorious security impovements were introduced.
So, can Bluetooth be called secured.
In a word, **no**.
There are still [several security problems within the standard][16]
and you'll find cracking tools
(such as Mik Rayn's [`crackle`][88] and [`btcrack`][87])
and sniffing tools ([Bluetooth Sniffing – Why bother?][89]) on the web.
In light of this, [NIST has published guidelines to manage Bluetooth security issues][85].

Bluetooth 5 doesn't plan to enhance security.

Keep in mind that Bluetooth only concerns itself with the device.
There is no user authentication in the standards, only device authentication.
An application developer can, and for most sensitive applications should, add user authentication.

For an overview of Bluetooth security and privacy features,
check out the following articles:

* [Increasing Wireless Security with Bluetooth Low Energy](http://eecatalog.com/IoT/2014/08/13/increasing-wireless-security-with-bluetooth-low-energy/)
* [Security Considerations For Bluetooth Smart Devices](https://www.design-reuse.com/articles/39779/security-considerations-for-bluetooth-smart-devices.html)
* [Bluetooth Low Energy Swiss-army knife](https://hackaday.com/2019/08/10/new-bluetooth-5-channel-hopping-reverse-engineered-for-jamming-and-hijacking/)

* https://www.sans.org/reading-room/whitepapers/wireless/bluetooth-inherent-security-issues-945
* http://www.lawtechnologytoday.org/2016/05/bluetooth-how-secure-is-it/
* http://electronics.howstuffworks.com/bluetooth4.htm
* http://www.radio-electronics.com/info/wireless/bluetooth/security.php
* How to distinguish between random and public GAP addresses? - https://devzone.nordicsemi.com/question/43670/how-to-distinguish-between-random-and-public-gap-addresses/

### Privacy
At time, Bluetooth devices must advertise their MAC address
but this can be used to track individual devices.
To safeguard user privacy,
manufacturers can make use of a Bluetooth Smart feature known as [LE Privacy][82].
This feature causes the MAC address within the advertising packets to be replaced
with a random value that changes at timing intervals determined by the manufacturer.
The real MAC address still exist but isn't advertised.

So what happens when two Bluetooth devices are paired?
Paired devices have a special trusted relationship with the tracker.
During the pairing, the two devices exchange encryption keys, one of which is concerned with privacy.
This privacy related key is called the Identity Resolution Key (IRK).
IRK allows the first device to translate those special,
random MAC addresses which appear in the advertising packets from the second device,
to the real MAC address in the second device.

### Data Signing
* http://www.electronicdesign.com/communications/ble-v42-creating-faster-more-secure-power-efficient-designs-part-4

### White List
BLE devices have the option of using a “White List” or Trusted Device Database (TDD)
to limit communication access to the local device and lower overall power consumption.
The White List is essentially a list of remote devices
that are allowed to communicate with the local device.
The White List resides in the Link Layer and is used to filter incoming
connection requests, scan requests, and advertising packets as designated by the Host Controller.
The whitelist can contain static MAC addresses and/or IRKs.

## Alternative to Bluetooth
[WiFi Direct][46] is the chief competitor to Bluetooth.
With WiFi Direct, you can now establish a direct,
peer-to-peer wireless connection without the assistance of a router
and WiFi Direct includes a painless discovery tool that makes it easy to find,
and connect with nearby devices.
While WiFi Direct exceeds Bluetooth in many ways,
it falls short where it often matters the most, battery life.
That said, both technologies have their benefits. Depending on your intended use,
you can make an argument for either specification.

Bluetooth boasts a typically more convenient connection process than its competitors (ZigBee specifically).
It excel at short-range cable-replacement-type applications
but isn’t the best choice for wireless job when you have dozons of devices,
ZigBee is often a good choice for monitoring large network of devices – like home automation projects.
These networks might have dozens of wireless nodes,
which are only sparsely active and never have to send a lot of data.
BLE combines the convenience of classic Bluetooth,
and adds significantly lower power consumption.
In this way it can compete with Zigbee for battery life.
BLE can’t compete with ZigBee in terms of network size,
but for single device-to-device connectivity it’s very comparable.

* [Bluetooth vs. Ant+ Revisited, Which Standard Wins?](http://www.sparxeng.com/blog/hardware/bluetooth-vs-ant-revisited-whic-standard-wins)
* [What’s The Difference Between Bluetooth Low Energy And ANT?](http://electronicdesign.com/mobile/what-s-difference-between-bluetooth-low-energy-and-ant)
* [Bluetooth Fights Back Against Thread](http://www.eetimes.com/document.asp?doc_id=1323126)
* [6LoWPAN vs Bluetooth LE](https://e2e.ti.com/support/wireless_connectivity/zigbee_6lowpan_802-15-4_mac/f/158/t/408652)
* [Overview for 6LoWPAN](http://www.ti.com/lsds/ti/wireless-connectivity/6lowpan/overview.page)
* [Overview for ZigBee® (IEEE 802.15.4)](http://www.ti.com/lsds/ti/wireless-connectivity/zigbee/overview.page)



## Bluetooth Compatibility
Bluetooth Low Energy was made part of the Bluetooth 4.0 specification back in 2010.
But it originated in 2006 in Nokia as [Wibree][66],
and is a different set of protocols than “classic” Bluetooth,
and as such, devices may not be backwards-compatible.
Hence you can now encounter three type of devices:

* **Bluetooth**: supporting only the “classic” mode.  Think headsets, wireless speakers, car infotainment systems, etc.
* **Bluetooth Smart Ready**: supporting both “classic” and BLE modes. Typically smartphones, PCs, tablets, etc.
* **Bluetooth Smart**: supporting only the BLE mode. Typical examples include smartwatches, fitness trackers, beacons, etc.

Or stated differently:

| If your product is    | Then your product can pair with |
|:---------------------:|:-------------------------------:|
| Bluetooth Smart Ready | Bluetooth Smart Ready + Bluetooth + Bluetooth Smart |
| Bluetooth             | Bluetooth Smart Ready + Bluetooth |
| Bluetooth Smart       | Bluetooth Smart Ready |

* **Bluetooth** refers to Bluetooth technologies 1.0, 2.0 or 3.0. Each Bluetooth version is
backwards compatible.
(Your Bluetooth smartphone, tablet, portable media player or laptop must be the
same Bluetooth version or higher as the accessory you would like to pair it with.)
* **Bluetooth Smart** devices are sensors, which send only small bits of data at a time
and use very little energy. They are sometimes referred to as Bluetooth Low Energy,
or BLE. These devices can stay paired to Bluetooth Smart Ready devices even when
they aren't being used.
Automatic wake and sleep modes eliminate the need for constant re-pairing of your
devices. Common Bluetooth Smart devices include heart rate monitors, sensors,
remotes, thermometers, smartwatches and fitness trackers.
* **Bluetooth Smart Ready** devices are primarily smartphones, tablets, portable
media players and laptops that can connect with both Bluetooth and Bluetooth
Smart devices.
These products send and receive data from any type of Bluetooth-enabled
accessory.
* **Bluetooth Smart Ready** and **Bluetooth Smart** refer to Bluetooth technology 4.0.
Bluetooth Smart accessories only work with Bluetooth Smart Ready smartphones,
tablets and laptops.

## Classic Bluetooth (BR/EDR)
There are essentially two strains of Bluetooth,
the older legacy or classic strain that encompasses versions 1.0 through 3.0
intended for continuous communications.
This is called Bluetooth Basic Rate/Enhanced Data Rate (BR/EDR).
The other strain is the low-energy Bluetooth that includes versions 4.0, 4.1, and 4.2
intended for short burst communications.
See this [video][32] and the bullet list below
for a practical description of the differences between these specifications.

* **Bluetooth Basic Rate/Enhanced Data Rate (BR/EDR)** enables continuous wireless connections
and uses a point-to-point device communications.
Bluetooth BR/EDR audio streaming is ideal for wireless speakers, headsets and hands-free in-car systems.
* **Bluetooth LE** enables short-burst wireless connections
and uses multiple network topologies, including point-to-point, broadcast and mesh.
    * **Point-to-point** is a network topology used to create one-to-one device communications.
    Bluetooth LE P2P topology is ideal for data transfers and well suited for connected device products,
    such as fitness trackers and health monitors.
    * **Broadcast** is a network topology that establishes one-to-many device communications.
    Bluetooth LE broadcast topology optimizes localized information sharing,
    making it ideal for beacon solutions, such as point-of-interest information
    and item and way-finding services.
    * **Mesh** is a network topology for many-to-many device communications.
    Bluetooth LE mesh topology creates large-scale device networks tailor-made
    for building automation, sensor network, asset tracking
    and any solution where multiple devices need to reliably and securely communicate with one another.

The low-energy version uses a different radio technology than the classic strain.
It employs frequency-hopping spread spectrum (FHSS) over the 2.4- to 2.483-GHz spectrum,
but uses 40 2-MHz-wide channels rather than the 79 1-MHz channels of classic Bluetooth.
Max data rate is 1 Mb/s.
Most of the newer Bluetooth chips actually contain both types of radios.

The big improvements added to Bluetooth 3.0 and 4.0 were significant.
While the general range of the wireless protocol remains the same (up to 300 feet),
version 3.0 enabled a much faster theoretical data throughput
of 26Mbps compared with the 2Mbps of version 2.1.
That's swift enough to handle data intensive tasks like video streaming.
The real benefit of Bluetooth 4.0 is energy efficiency.
Designed primarily for devices that collect information frequently,
either as much as five times a second or just once every hour,
the standard is optimized for long battery life
(potentially, battery longevity increase by 5 to 10).

## Bluetooth Low Energy (BLE) / Bluetooth 4.0 / Bluetooth 4.2
Bluetooth Low Energy (BLE), sometimes referred to as "Bluetooth Smart", is a light-weight subset of classic Bluetooth and was introduced as part of the Bluetooth 4.0 core specification. While there is some overlap with classic Bluetooth, BLE actually has a completely different lineage and was started by Nokia as an in-house project called 'Wibree' before being adopted by the Bluetooth SIG.  - https://learn.adafruit.com/introduction-to-bluetooth-low-energy/introduction

Bluetooth 4, also known as Bluetooth Low Energy / Bluetooth LE / BLE / Bluetooth Smart,
is the fourth version of the Bluetooth standard.
Finalized in 2010, Bluetooth 4.0 has been updated several times since,
and the current version is 4.2, released in July of 2015.
The purpose of Bluetooth LE is to open the standard up to a new class of devices:
those that send small amounts of data infrequently, and run off of small batteries.

The 4.2 version creates three different classes of device:
Standard Bluetooth (or just Bluetooth), Bluetooth Smart Ready, and Bluetooth Smart.

* **Standard Bluetooth** device have the classic power consumption,
such as a cell phone or USB dongle, can also send and receive Bluetooth LE signals.
* **Bluetooth Smart** indicates a low power device, such as a pedometer or heart monitor,
that can only send and receive Bluetooth LE signals
* **Bluetooth Smart Ready** device can handle LE and standard Bluetooth signals.

There are multiple companies that make Bluetooth chips, such as
[Nordic Semiconductor](http://www.nordicsemi.com/eng/Products/Bluetooth-low-energy),
[Texas Instruments](http://www.ti.com/lsds/ti/wireless-connectivity/bluetooth-low-energy/overview.page?DCMP=BluetoothLowEnergy&HQS=Bluetoothlowenergy),
and [CSR](http://www.csr.com/products/bluetooth-smart-starter-development-kit).

Bluetooth Smart has two ways of communicating. The first one is using advertisements, where a BLE peripheral device broadcasts packets to every device around it. The receiving device can then act on this information or connect to receive more information. The second way to communicate is to receive packets using a connection, where both the peripheral and central send packets.

Bluetooth classifies devices by their purpose,
creating a number of profiles for things.
Bluetooth LE adds a new set of these profiles,
called [Generic Attribute (GATT) profiles][17].
These include profiles for devices such as blood pressure monitors,
and more generic profiles for devices like key fobs (the proximity profile).
Most Bluetooth LE devices support a number of these profiles,
with the specific profiles that are enabled being controlled by the firmware on the device.

Be aware that it has been demonstrated that Bluetooth has
[numerous security problems within the standard][16],
breaking the encryption that the protocol uses and demonstrating
how it is possible to remotely crash an Android phone using a Bluetooth radio.
See [Mike Ryan's talk][18] on the subject (also [slides][19]).


## Difference Between Bluetooth Low Energy and Classic Bluetooth
Classic Bluetooth & Bluetooth low energy - [what's the difference][31]?
Also see this [video][30].
The original Bluetooth, known as Bluetooth Classic, was designed as a short-range,
cable-replacement technology for point-to-point communications.
The standard quickly became the default technology for wireless data exchange
between personal computing equipment (mobile phones, PCs, PDAs)
and peripherals (headsets, cordless keyboards and mice, printers, and such).
Devices could form a tiny personal area network (PAN) called a piconet,
whereby a single central device would coordinate the activity of up to seven active peripherals.

Fast-forward to 2010, the Bluetooth Core Specification version 4.0 is released,
introducing Bluetooth Low Energy (BLE), more commonly known as Bluetooth Smart.
This is where the story of Bluetooth in the IoT really begins.
Bluetooth Smart was designed specifically to address the needs of a new generation of smart devices,
many of which are battery-powered and therefore require fast connection times
and efficient power management to reduce unnecessary energy consumption.

The Bluetooth low energy device consumes less energy that the classic by
being in sleep mode most of the time.
ts maximum/peak power consumption is only 15 mA
and the average power consumption is of only about 1 uA.
In Bluetooth low energy technology,
the actual connection times are of only a few mS
and thereby the connection is quickly initiated as the device wakes up.

Data transfer rates with Classic Bluetooth technology
using Enhanced Data Rate (Bluetooth v2.1 + EDR)
can exceed 2 Mbps (actual payload),
but practical transfer rates for Bluetooth low energy technology
are below 100 kbps (actual payload of roughly 1/20).

Just as with Classic Bluetooth technology,
Bluetooth low energy technology is based on a master connected to a number of slaves.
However, in Bluetooth low energy technology the number of slaves can be very large;
how large depends on the implementation and available memory.

## Bluetooth 5
Prior to Bluetooth 5, Bluetooth comes in two flavors: “Classic” and “Low Energy”.
The former is the Bluetooth that enables our wireless keyboards and mice,
along with wireless headsets and speakers.
The latter, Bluetooth Low Energy (BLE) uses a lot less power and is designed for areas
like health care, fitness, and beacons.
Bluetooth 5 is intended to take you further & faster by offers a special kind of connection
which is designed for long distance communications, at low power, and moderate bit rates.
So this isn’t for Bluetooth speakers or for syncing your smartwatch with your smartphone,
this is for the Internet of Things (see [here][52]).

[Bluetooth SIG released the Bluetooth 5 specification in December 2016][29]
and said ito would change the way that people interact with the Internet of Things.
(See this [video][33] for a good description and advantages of Bluetooth 5)
Bluetooth 5 claims a 4x range, 2x speed and 8x broadcasting message capacity of it predecessor.
These features, along with improved interoperability and coexistence with other wireless technologies.
Bluetooth 5 is an enhancement to the low-energy version.
Bluetooth 5 introduces a new radio PHY called ‘LE 2M’
that doubles the max data rate up to 2 Mb/s.
Bluetooth 5 also introduces a second new, optional radio PHY called ‘LE Coded’
which also supports four discrete data rate speeds
(125Kbit, 500Kbit, 1Mbit, and 2Mbit).

Bluetooth 5 ups the payload capacity of it packets.
Data packets can now be in the 31- to 255-byte range,
and that means fewer transmissions and less broadcast time.
Together with advancements introduced in Bluetooth 4.2 ([Data Length Extensions (DLE)][51]),
overall throughput is x5 higher than the original Bluetooth 4.0 level.
Now net data throughput, not including overhead such as addressing, can be as high as 1.4Mbs
(see [here][50]).

The higher data rate also decreases the transmission time of the messages
sent to better conserve power.
The basic power output level is 0 dBm or 1 mW (class 3),
but higher-power classes of Bluetooth can also be used.
The options are 4, 10, or 20 dBm for extended range.

Low-energy Bluetooth has a nominal range of 10 to 30 meters.
Bluetooth 5 extends this to the 30- or 50-meter range.
With a line-of-sight path, the range can be many hundreds of meters.
The longer range in Bluetooth 5 is also helped by using a strong
forward-error-correction (FEC) scheme to correct errors.
It trades off speed for range, which is a positive feature for some applications.

|                         | BLE 4.2   | BLE 5     | BLE 5 Long Range (S=2) | BLE 5 Long Range (S=8) |
|-------------------------|-----------|-----------|------------------------|------------------------|
| Connection speed        | 1 Mbps    | 2 Mbps    | 1 Mbps                 | 1 Mbps                 |
| Network data rate       | 1 Mbps    | 2 Mbps    | 500 Kbps               | 125 Kbps               |
| Data throughput         | 800 Kbps  | 1400 Kbps | 380 Kbps               | 109 Kbps               |
| Error Correction        | None      | None      | FEC                    | FEC                    |
| Bluetooth 5 Requirement | Mandatory | Optional  | Optional               | Optional               |

>**NOTE:** The lower packet coding of 125kbps or 500kbps
are obtained using both FEC and [spreading factor][53] of S=2 or S=8.

Bluetooth 5 also incorporates features to better minimize interference.
Bluetooth shares the 2.4-GHz ISM band with WiFi, ZigBee,
and a bunch of other wireless devices,
so there’s a greater likelihood for interference.
The new features detect and prevent interference at the band edges.
Version 5 should also expand the reach beacons for proximity sensing and location messaging.
And all the while, Bluetooth 5 is backwards-compatible with the Bluetooth 4.x versions.

To take an even deeper dive into Bluetooth 5, check out these references:

* [What is Bluetooth 5? Learn about the Bit Paths Behind the New BLE Standard](https://www.allaboutcircuits.com/technical-articles/long-distance-bluetooth-low-energy-bit-data-paths)
* [What is Bluetooth 5 – Gary explains](http://www.androidauthority.com/bluetooth-5-gary-explains-703734/)
* [The truth about Bluetooth 5 – Gary explains](http://www.androidauthority.com/bluetooth-5-speed-range-762369/)
* [Taking a deeper dive into Bluetooth 5 from Nordic Semiconductor](http://www.semiconductorstore.com/blog/2017/Taking-a-deeper-dive-into-Bluetooth-5-from-Nordic-Semiconductor/2265)
* [What’s New with Bluetooth 5.0?](http://www.summitdata.com/blog/whats-new-with-bluetooth-5-0/)




* [Add Bluetooth 5 to Raspberry Pi 3 or create gadgets with this new chip](http://www.itworld.com/article/3172470/internet-of-things/add-bluetooth-5-to-raspberry-pi-3-or-create-gadgets-with-this-new-chip.html)

## Bluetooth Mesh
The reason why Bluetooth Smart was never considered a serious contender for
building automation purposes is because it was designed
to support relatively simple hub-and-spoke networks.
Its hub-and-spoke model couldn't match with the mesh topology of ZigBee or Z-Wave networks,
and for this reason Bluetooth could never really compete with the two in the applications they were intended for.
Even though the support for mesh networking wasn't included in the core specification of Bluetooth Smart,
several companies sensed that building a mesh network had enormous possibilities.
In 2014, [Silvair (operating as Seed Labs back then)][35]
started building a mesh architecture based on Bluetooth Smart.
Silvair and others have formed a [Bluetooth Smart Mesh Working Group][36].
At this time, it appears thar Bluetooth Mesh will be coming out on Bluetooth 5,
but [no specific timeline for specfications to be delivered][37].

To learn more about Bluetooth Mesh, check out the following:

* [Getting Started with Bluetooth Mesh Development](https://store.makerdiary.com/blogs/tutorials/getting-started-with-bluetooth-mesh-development)
* An Intro to Bluetooth Mesh:
[Part 1](https://blog.bluetooth.com/an-intro-to-bluetooth-mesh-part1),
[Part 2](https://blog.bluetooth.com/an-intro-to-bluetooth-mesh-part2)
* [Bluetooth Mesh - What's that noise about?](http://www.ledsmagazine.com/articles/print/volume-13/issue-3/features/smart-lighting/bluetooth-mesh-what-s-that-noise-about.html)
* [How Bluetooth 5 and ilumi MeshTek create the perfect IoT platform for 2017 and beyond](https://ilumi.co/blogs/pulse/how-will-bluetooth-5-impact-bluetooth-mesh-networks)
* [Introducing the world’s first BLE mesh networking that lasts years on battery power](http://blog.estimote.com/post/153812538740/introducing-the-worlds-first-ble-mesh-networking)
* [Securing the Mesh](https://hackaday.io/project/6020-bluetooth-low-energy-mesh-protocol/log/19063-securing-the-mesh)
* [Bluetooth Mesh Developer Study Guide](https://blog.bluetooth.com/2018-top-5-developer-resources)

Silicon Labs
* https://sub.allaboutcircuits.com/white-papers/silicon-labs/Whitepaper_Bluetooth_Mesh_Technology.pdf
* https://www.silabs.com/products/development-tools/software/bluetooth-low-energy/ble-mesh
* https://www.silabs.com/products/wireless/bluetooth/bluetooth-mesh-introduction
* https://www.silabs.com/products/development-tools/wireless/bluetooth/blue-gecko-bluetooth-low-energy-soc-starter-kit
* https://www.silabs.com/products/development-tools/software/bluetooth-low-energy/mobile-apps/ble-mesh
* https://www.silabs.com/products/wireless/learning-center/bluetooth/bluetooth-mesh
* http://pages.silabs.com/BluetoothMesh.html?source=Event&detail=Webinar

### Estimote Mesh
Estimote claims to have the first truly low-energy BLE mesh networking solution.

**Estimote Proximity Beacons**
The *Proximity* approach involves “tagging” certain areas
(a hotel lobby, a restaurant table, an airport gate, etc.)
with a beacon recognizable by smartphones.
Estimote Proximity Beacons support iBeacon and Eddystone protocols,
you can tune a beacon’s broadcasting power to adjust the range,
offer over three years of battery life on default settings, and have a range of up to 70 meters.

lifetime: 2 years
range: 70 m
packets: iBeacon or Eddystone
features: motion & temperature sensor, NFC

* [Estimote LTE Beacons hit the market](https://appdevelopermagazine.com/estimote-lte-beacons-hit-the-market/)

**Long Range Location Beacons**
http://estimote.com/?gclid=CjwKEAjwhYLLBRDIjoCu0te4niASJAC0V4QPTjxonMHyLfHotmjcu32QrsWTfDSMMH4f3rl_xevcxBoCp1Xw_wcB

**Estimote Stickers**

**Estimote UWB Location Beacons**
Estimote UWB Location Beacons are a new generation of product.
They are tailored for Indoor Location
and together with Estimote Indoor Location SDK,
they turn a smartphone into a sophisticated compass to position and navigate in a venue.
The UWB Location Beacons support multi-packet advertising, mesh networking,
have built-in sensors, and a range of 200m.

[Cuseum](https://www.cuseum.com/)
* [mobile engagement](https://www.cuseum.com/mobile-engagement/)
supports curated tours, content management, perks and donations, notifications, indoor wayfinding.
* [digital membership](http://membership.cuseum.com/)
promotions & membership benefits, online purchasing, membership outreach

## Bluetooth Beacons
BLE devices can operate in a non-connectable, [advertisement][70] only mode
(where all the information is contained in the advertisement),
but they can also allow connections (and usually do).
This is what a Bluetooth beacon does.
There are currently three standards of beacons:
iBeacon, Eddystone, and AltBeacon.
Each of these three standards have many beacon manufacturers
that either support all or some of the standards,
but they all run on the same BT LE technology.
Initially, only Apple’s iBeacons existed and they had several limitations.
First they only transmit a UUID (universally uniquely identifiable ID)
and they could only be detected by iPhones.
In July 2015, Google released the specification of Eddystone,
which provides more frame types (UUID, URL and telemetry).

* [A BLE Advertising Primer](http://www.argenox.com/a-ble-advertising-primer/)
* [Guide to iBeacon Hardware](http://beekn.net/guide-to-ibeacons/)
* [The Beacon Experiments: Low-Energy Bluetooth Devices in Action](http://blog.shinetech.com/2014/02/17/the-beacon-experiments-low-energy-bluetooth-devices-in-action/)
* [The Hitchhikers Guide to iBeacon Hardware: A Comprehensive Report by Aislelabs (2015)](http://www.aislelabs.com/reports/beacon-guide/)

### Apple iBeacon
iBeacon has been around since 2013.
Apple first announced the exciting new platform at the 2013 Worldwide Developers Conference,
though its release went almost unnoticed in a number of ways.
It would also take time for the world to understand the fundamental nature of the protocol.
A beacon using an iBeacon profile contains a combination of letters and numbers,
broken up into specific groups.
Each code is unique for every beacon, and a mobile application will only take action when
it recognizes the data related to that beacon.
Once a beacon is detected by an application, some kind of action is triggered:
a push alert to the home screen, a prompt to log something into the phone, connect to a server, and so on.

When broadcasting iBeacon, an advertising packet consists of four main components.

1. **UUID (Universally Unique Identifier)**: The UUID contains 32 hexadecimal digits, split into 5 groups.
1. **Major**: This is a 2 byte string used to identify a smaller subset of beacons within a larger group
1. **Minor**: This is a 2 byte string that identifies individual beacons.
1. **Tx Power**: A TX power level in 2's compliment, indicating the signal strength one meter from the device. This number must be calibrated for each device by the user or manufacturer.

* [How do iBeacons work?](http://www.warski.org/blog/2014/01/how-ibeacons-work/)
* [linux-ibeacon - Python script that creates an Apple iBeacon®-compatible Bluetooth LE beacon using a computer running Linux and a Bluetooth LE adapter](https://github.com/dburr/linux-ibeacon/)
* [iBeacon vs Eddystone – which is the better one for your business?](https://www.whatech.com/mobile-apps/blog/271289-ibeacon-vs-eddystone-which-is-the-better-one-for-your-business)

### Google Eddystone
Eddystone is an open-source library built by Google as part of their
Physical Web project for developers to leverage beacons in ways that
make experiences more meaningful and substantial than a one-off application use.
In contrast to Apple’s closed and proprietary iBeacon protocol,
which transmits IDs to users that must be consumed by specially-built mobile apps,
the Eddystone beacon protocol emits a URL that developers can
configure in a beacon either manually or by using a backend service.
Eddystone expands beacon functionality with links,
rather than with app notifications (although it also supports app notifications),
and since the URLs it emits are consumable by the Chrome browser already installed on many devices,
especially Android phones,
the protocol is not dependent on a one-off mobile app download to drive the experience.

The main function of Eddystone is to transmit sensor and administrative data from the beacon itself.
When broadcasting Eddystone, its advertising packet consists of four main components
and is differtned than iBeacon's:

1. **Eddystone-URL**: contains a compressed URL and is the beacon format for the “Physical Web”.
Eddystone-URL does NOT require a custom app but does require a beacon browser ([Physical Web Browser][64]).
You can link to any site on the Internet.Those links can be easily managed with [Physical Web Remote Contro][65].
1. **Eddystone-UID**: Eddystone-UID contains an identifier of a beacon and
requires an app to receive that specific UID for your app to be able to engage.
Eddystone is very similar to iBeacon, but it only broadcasts a 16 digit string of characters,
divided into a 10 character “Namespace” and a 6 character “Instance” ID.
1. **Eddystone-TLM (telemetry packet)**: Eddystone-TLM packet is designed to be broadcast
by the beacon alongside the “data” (i.e., UID and/or URL).
Currently this frame includes the beacon’s battery state, its temperature, the time since power-on,
and a count of the advertising packets since power-on, but it could also include other sensor data in the future
1. **Eddystone-EID**: A time-varying beacon frame that can be resolved to a stable identifier by a linked resolver,
such as Proximity Beacon API. The main purpose of Eddystone-EID so you can control who has access to your beacon sign.

At Google I/O 2015, Eddystone became even more powerful with the introduction of two new APIs:
Proximity Beacon API and the Nearby API. The Proximity beacon API essentially revolves around how developers
can manage the data collected through beacons and smartphones.
The Nearby API is available to developers and aims at putting proximity features into devices at the OS level instead of at the app level.
The Nearby API encompasses three formats – Nearby Messages, Nearby Connections and Nearby Notifications.

This firmware application is fully configurable via [Eddystone Configuration GATT Service][07].
There are several ways to configure the Eddystone beacon.
For example:

* [Web Bluetooth Configuration Tool][08] (Android | iOS | Desktop)
* [nRF Beacon for Eddystone][09] (Android)
* Updating the firmware can be done using nRF Connect ([Android][11] | [iOS][12]).

You can build simple interactions between [nearby][10] devices and people:

* Nearby Messages exposes simple publish and subscribe methods that rely on proximity.
* Nearby Connections enables your app to easily discover other devices on a local network, connect, and exchange messages in real-time. Use Nearby Connections to create multiplayer and multi-screen experiences.
* Nearby Notifications is a new feature allowing developers to tie an app or website to a BLE beacon and create contextual notifications, even with no app installed.

Eddystone Beacons are different: they don't require an external database like iBeacons,
instead they use web links to either link to data directly or,
in the future, possibly as a two-way communication method.
Eddystone has the advantage of transmitting rich and strong data to your devices.
While iBeacon uses only one packet of identification,
Eddystone uses three different kinds – UID, URL and TIM.
That said there is a heavier app-side workload to Eddystone as compared with iBeacons or AltBeacons.
iBeacons are currently the most widely used,
but Eddystone have a great deal of untapped potential and will become a driving force of IoT in the future.

>**NOTE:** Another Beacon type, UriBeacon (pronounced YUR-ee-BEE-kun) has evolving to become part of the
[Eddystone open beacon format](https://github.com/google/eddystone)!

* [Chrome for Android Gets Support for Google's Eddystone Beacon Platform](http://gadgets.ndtv.com/apps/news/chrome-for-android-gets-support-for-googles-eddystone-beacon-platform-801234)
* [Google’s ‘open’ eddystone vs apple’s ibeacon – which one works better for you](https://www.whatech.com/development/press-release/254801-google-s-open-eddystone-vs-apple-s-ibeacon-which-one-works-better-for-you)
* [DIY Google's "Physical Web" UriBeacons with the Bluefruit LE Friend](https://learn.adafruit.com/google-physical-web-uribeacon-with-the-bluefruit-le-friend/getting-started)

### AltBeacon
Because there is no open and interoperable specification for proximity beacons,
Radius Networks has authored the [AltBeacon][63]
specification as a proposal for how to solve this problem.
With AltBeacon it becomes possible to have application-specific UUIDs rather than company-specific,
giving the ability to change the company ID instead.
The AltBeacon spec seems to be a direct response to the closed source iBeacon spec that Apple is using;
it covers the same functionality that an iBeacon has but is not company-specific.
That said, it is not as widely supported (yet).

iBeacons and AltBeacons are almost the same thing:
they broadcast a UUID from the beacon itself and use external databases to give beacons meaning.
iBeacons are closed source, Apple-branded, and widely used;
AltBeacons are open source and provide more data fields to use, but few people use them yet.

### Differences Between iBeacon, Eddystone & AltBeacon
[!edddystone-vs-physicalweb-ibeacon](https://s-media-cache-ak0.pinimg.com/564x/86/85/81/868581a34b99dca7267b753af596dfc7.jpg)
The packet formats for each of these protocols is different.
Which one to use, totally depends on the use case,
because each protocol have their pros and cons.

* [Eddystone vs Physical Web vs iBeacon: Why Eddystone will Rule the Beacon Space](https://blog.beaconstac.com/2016/08/eddystone-vs-physical-web-vs-ibeacon-why-eddystone-will-rule-the-beacon-space/)
* [What are the key differences between iBeacon, Eddystone & AltBeacon?](https://www.quora.com/What-are-the-key-differences-between-iBeacon-Eddystone-AltBeacon)
* [Understanding the different types of BLE Beacons](https://developer.mbed.org/blog/entry/BLE-Beacons-URIBeacon-AltBeacons-iBeacon/)
* [iBeacon vs Eddystone: Which one works better for your Pilot Project?](https://blog.beaconstac.com/2016/01/ibeacon-vs-eddystone/)
* [AltBeacon vs. iBeacon, isn't this just fragmenting things further?](https://community.aerohive.com/aerohive/topics/altbeacon-vs-ibeacon-isnt-this-just-fragmenting-things-further-ibeaconwebinar)
* [BLE beacons, Eddystone and Physical Web: an introduction](https://www.blueupbeacons.com/docs/WorkshopBeacons.pdf)

### Physical Web Beacons
[!physical-web-logo](http://bkon.com/wp-content/uploads/2015/12/Physical-Web-Logo-Large-122915.png)
[Google has launched][06] the concept of the [Physical Web][04] in [Chrome][04],
on [Andriod phones][05],
and in their latest version of [Chrome for iOS][03]
The [Physical Web][01] offers a universal way to interact with any smart device,
a vending machine, a poster, a menu, a parking meter, a retail display
without first having to download an app, where everything is just a tap away.
For example, a user would approach a beacon installed in a museum,
and if the visitor’s mobile device is Physical-Web-enabled—if the service has been enabled
in the phone’s Chrome browser—a notification will appear in the phone’s notification tray
with a URL on which to click to learn more about the location.

The Physical Web is not shipping yet nor is it an official Google product.
This is an early-stage experimental project we're developing out in the open as we do all things related to the web.

[Physical Web Browsers][02], sometimes called Beacon Scanners,
these are the tools you use to access Eddystone-URL beacon content on the Physical Web.

Eddystone, iBeacon and Bluetooth certified

* [Meet Google’s “Eddystone”—a flexible, open source iBeacon fighter](http://arstechnica.com/gadgets/2015/07/meet-googles-eddystone-a-flexible-open-source-ibeacon-fighter/)
* [The Physical Web](https://google.github.io/physical-web/)

### Google Beacon Platform
* Google Beacon Platform - https://developers.google.com/beacons/
* Code samples for Google's beacon platform - https://github.com/google/beacon-platform
* Beacons 101-- Getting Started with the Google Beacon Platform - https://www.youtube.com/watch?v=0QeY9FueMow

Beacon Tools lets you register your Bluetooth Low Energy (BLE) beacons with the Google Beacon Registry and create small attachments for them. - https://play.google.com/store/apps/details?id=com.google.android.apps.location.beacon.beacontools

## Web Bluetooth
Web Bluetooth is a specification for Bluetooth API to
allow websites to communicate with BLE devices, using
the Generic Attribute Profile (GATT), in a secure and
privacy-preserving way.
A website, running in the Central role, can connect to
remote GATT Servers over a BLE connection.
You can interact with a BLE-enabled device from a
website with a browser (no app required)

Web Bluetooth or [Web Bluetooth API][38]
is a developing JavaScript API to allow websites to communicate with Bluetooth devices.
Sites ask the browser to show a list of nearby Bluetooth devices matching certain criteria,
and the user either picks which to grant access to or cancels the dialog.
This group is developing a [specification for Bluetooth APIs][13] to allow websites
to communicate with devices in a secure and privacy-preserving way.

This new and experimental API, newly introduced into Chrome browsers,
pushes boundaries of beacon capabilities even further.
It allows a web page to interact directly with a Bluetooth device.
Pairing beacons with a beautiful website lets users experience the world around them as never before,
bridging the web, mobile and physical realms together via these low-energy Bluetooth-powered devices.

[The Web Bluetooth Security Model][14]
[Some believe Web Bluetooth represents a security risk][15].

Simple Demo .... toggling a led on a BLE-enabled
device, using Web Bluetooth API.
We use:
● a browser
● a HTTPS site
● a BLE connection


########################### BlueZ for Bluetooth Mesh ###########################
* [How to Deploy BlueZ v5.48 on Raspberry Pi 3](https://blog.bluetooth.com/bluez-on-raspberry-pi)

* [Using BlueZ v5.50 and the Raspberry Pi 4 Update to Create a Bluetooth Mesh Provisioner](https://www.bluetooth.com/blog/use-bluez-v5-50-andraspberry-pi-4-updateto-create-a-bluetoothmesh-provisioner/)
    * [Deploying BlueZ v5.50 on Raspberry Pi, Part 1 - Deploying](https://www.bluetooth.com/bluetooth-resources/how-to-deploy-bluez-v5-49-on-raspberry-pi3-and-use-it-part-1/)
    * [Deploying BlueZ v5.50 on Raspberry Pi 3, Part 2 — Provisioning](https://www.bluetooth.com/bluetooth-resources/how-to-deploy-bluez-v5-50-on-raspberry-pi-3-and-use-it-part-2-provisioning/)
########################### BlueZ for Bluetooth Mesh ###########################

################################ Web Bluetooth #################################
* [Intro to Web Bluetooth](https://www.bluetooth.com/bluetooth-resources/intro-to-web-bluetooth/)
################################ Web Bluetooth #################################

# BLE iBeacon Scanning
* [Use Node.js And A Raspberry Pi Zero W To Scan For BLE iBeacon Devices](https://www.youtube.com/watch?v=AFjYKEf7j2M)

# Linux Bluetooth Tools
BlueZ is an open source project and the official Linux Bluetooth protocol stack.

* [How to setup bluetooth in Linux with bluez and hcitool](https://fixmynix.com/bluetooth-in-linux-with-bluez-and-hcitool/)
* [Setup bluetooth in Linux part 2 – hcitool, bluez and rfcomm](https://fixmynix.com/bluetooth-linux-part-2/)
* Low-level bluetooth utility - https://unix.stackexchange.com/questions/93625/low-level-bluetooth-utility
* Using Bluetooth low energy in linux command line - https://stackoverflow.com/questions/17835469/using-bluetooth-low-energy-in-linux-command-line
* [rfkill](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Power_Management_Guide/RFKill.html)

[Get started with BLE on Linux][79] requires understand several tools.
Unfortunately, documentation about these tools is sparse to non-existent.
I'll try to over come that with some examples below.
In these examples, the Linux Raspberry Pi 3 is call `BlueRPi`
and the BLE device I'll be using is the
Nordic Thingy:52 called `Thingy:5` who's MAC address is `E8:C9:45:BC:BE:34`.
Also not that the Bluetooth version being used on the Raspberry Pi
is Bluetooth 4.1 (use `hciconfig -a` to get this information).

## BlueZ - Linux Bluetooth Protocol Stack
[BlueZ][34] is a Bluetooth stack for Linux kernel-based family of operating systems.
Its goal is to program an implementation of the Bluetooth wireless standards specifications for Linux.
It was initially developed by Qualcomm,
and is available for Linux kernel versions 2.4.6 and up.
In addition to the basic stack, the `bluez-utils` and `bluez-firmware` packages
contain low level utilities such as `dfutool` which can interrogate the Bluetooth adapter chipset
to determine whether its firmware can be upgraded.

You can check what version of BlueZ you currently have via this command:

```bash
# list version of the bluez package
$ dpkg --status bluez | grep '^Version:'
Version: 5.23-2+rpi2
```

Checking the BlueZ website, I found that this version was released in September of 2014!
The latest available BlueZ version can be found at [BlueZ.org][34]
If you want to install and run the latest version of BlueZ,
you'll need to install it yourself.
You might want to give this serious consideration,
as you can see, it is very likely that the Raspberry Pi package version is old.
Reliable installation instructions for BlueZ are hard to find,
but I used the following as my guide:

* [Flash Raspian Lite and set up latest BlueZ for Raspberry Pi 3](https://gist.github.com/larsblumberg/2335c0ba97f805a2b996f1a7c3ac9571)
* [Adafruit provide install instructions for BlueZ](https://learn.adafruit.com/install-bluez-on-the-raspberry-pi/installation)


############################################
IMPORTANT - Do you need this???
* [Controller AA:AA:AA:AA:AA:AA after updating Bluez](https://www.raspberrypi.org/forums/viewtopic.php?f=28&t=178356)
* [Update Bluez version PI 3](https://www.raspberrypi.org/forums/viewtopic.php?f=63&t=145364)
* [Raspberry Pi 3 blues 5.42 installation script](https://gist.github.com/tongo/94338cebf4e6367d353439bca8d0a376)
* [BCM43430 patches for BlueZ 5.43 (Raspbian Stretch)](https://www.raspberrypi.org/forums/viewtopic.php?f=66&t=176348)
* [Bluetooth problem encounted in Rasbian Jessie version July 2017](https://www.raspberrypi.org/forums/viewtopic.php?f=91&t=189871&p=1193566&hilit=BlueZ+5.46+Raspberry&sid=70ad8d4ecbd6b1f246c9da19d0aa9ce5#p1193566)
* Do you need this patch - https://github.com/ukBaz/python-bluezero/issues/30#issuecomment-250594754

$ /usr/bin/hciattach /dev/ttyAMA0 bcm43xx 921600 noflow -
bcm43xx_init
Flash firmware /lib/firmware/BCM43430A1.hcd
Set Controller UART speed to 921600 bit/s
Device setup complete
############################################


### Step X: Stop Legacy Bluez and Install Dependencies - DONE
Raspberry Pi 3 comes with the BlueZ package installed but is typical old
and many good features are missing.
To get these latest features, you need to compile the latest source for BlueZ.

First, lets check the version of the Bluetooth software that is currntly running:

```bash
# list version of the bluez package
$ dpkg --status bluez | grep '^Version:'
Version: 5.23-2+rpi2

# bluetooth standard supported
$ hciconfig -a hci0 version
hci0:	Type: BR/EDR  Bus: UART
	BD Address: B8:27:EB:F3:A4:64  ACL MTU: 1021:8  SCO MTU: 64:1
	HCI Version: 4.1 (0x7)  Revision: 0xb6
	LMP Version: 4.1 (0x7)  Subversion: 0x2209
	Manufacturer: Broadcom Corporation (15)

# version of bluetooth agent
$ bluetoothctl
[NEW] Controller B8:27:EB:F3:A4:64 BlueRPi [default]
[bluetooth]# version
Version 5.23
```

Bluetooth uses the [linux init system `systemd`][91] is as its daemon manager,
and as such, Bluetooth's daemon is controled via `systemctl`.
Lets stop running the old Bluez install the required dependancy for the new software:

```bash
# stop the bluetooth daemon and check its status
sudo systemctl stop bluetooth
sudo systemctl status bluetooth

# install bluez dependencies
sudo apt-get update
sudo apt-get install libusb-dev libdbus-1-dev libglib2.0-dev libudev-dev libical-dev libreadline-dev libdbus-glib-1-dev unzip
```

### Step X: Download BlueZ Source - DONE
The most up to date Linux Bluetooth software will
require your to build the package from source.

```bash
# go to the directory you wish to store the source code
cd ~/src

# download bluez the latest source found at http://www.bluez.org/download/
# and unpack the tar file
wget http://www.kernel.org/pub/linux/bluetooth/bluez-5.46.tar.xz
tar xvf bluez-5.46.tar.xz
rm bluez-5.46.tar.xz
```

### Step X: Compile & Install BlueZ Source - DONE
Now enter the BlueZ directory, configure the files,
compile the source, and then install executables.
For information about the options used by `./configure`,
check out the `README` file within BlueZ.
Two key option are `--enable-experimental` which enables the news features in BlueZ
and `--enable-deprecated` which enables deprecated tools like `hcitool`, `gatttools`, and others.

```bash
cd bluez-5.46

# confiure the files
./configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var --enable-library --enable-experimental --enable-deprecated

# compile the source
make

# install the executables, replacing any file that may already exist
sudo make install
sudo ln -svf /usr/libexec/bluetooth/bluetoothd /usr/sbin/
sudo install -v -dm755 /etc/bluetooth
sudo install -v -m644 src/main.conf /etc/bluetooth/main.conf

# if for some reason you want to start over, do "make clean"
```

### Step X: Install BlueZ Deprecated gatttool Tool - DONE
The BlueZ package comes with several deprecated tools,
but if you set `configure` as shown above,
These tools include the following:

* **bluemoon** - is a Bluemoon configuration utility.
* **bluetoothctl** - is the interactive Bluetooth control program.
* **bluetoothd** - is the Bluetooth daemon.
* **btmon** - provides access to the Bluetooth subsystem monitor infrastructure for reading HCI traces.
* **ciptool** - is used to set up, maintain, and inspect the CIP configuration of the Bluetooth subsystem in the Linux kernel.
* **hciattach** - is used to attach a serial UART to the Bluetooth stack as HCI transport interface.
* **hciconfig** - is used to configure Bluetooth devices.
* **hcidump** - reads raw HCI data coming from and going to a Bluetooth device and prints to screen commands, events and data in a human-readable form.
* **hcitool** - is used to configure Bluetooth connections and send some special command to Bluetooth devices.
* **hex2hcd** - is used to convert a file needed by Broadcom devices to hcd (Broadcom bluetooth firmware) format.
* **l2ping** - is used to send a L2CAP echo request to the Bluetooth MAC address given in dotted hex notation.
* **l2test** - is a L2CAP testing program.
* **rctest** - is used to test RFCOMM communications on the Bluetooth stack.
* **rfcomm** - is used to set up, maintain, and inspect the RFCOMM configuration of the Bluetooth subsystem in the Linux kernel.
* **sdptool** - is used to perform SDP queries on Bluetooth devices.

One tool wasn't installed and that is `gatttool`.
To install this,

```bash
# install the deprecated tool gatttool
sudo ln -svf ~/src/bluez-5.46/attrib/gatttool /usr/bin/
```

### Step X: Enable bluetoothd Daemon - DONE
To enable BlueZ's experimental features,
you need to modify the bluez service configuration
where the daemon is identified for execution.
You do this modifing the `/lib/systemd/system/bluetooth.service` file as noted below:

* [Creating a Linux service with systemd](https://medium.com/@benmorel/creating-a-linux-service-with-systemd-611b5c8b91d6)

```bash
# change this line
ExecStart=/usr/local/libexec/bluetooth/bluetoothd

# and change it to this
ExecStart=/usr/local/libexec/bluetooth/bluetoothd --experimental
```

Next you can check that the bluez service is installed and in a good state,
then manually start the bluez service.
Depending on how you came about installing BlueZ, you make need to do some "unmasking".
See "[systemctl, how to unmask][92]" and
"[How To Use Systemctl to Manage Systemd Services and Units][91]" to understand unmasking.

```bash
# tell systemd to reload its configuration file
sudo systemctl daemon-reload

# enable bluetooth automatic start-up after reboot
sudo systemctl enable /lib/systemd/system/bluetooth.service
sudo systemctl enable /lib/systemd/system/hciuart.service

# restart the bluetooth daemon
sudo systemctl restart bluetooth

# now check the bluetooth daemon's status
$ sudo systemctl status bluetooth
● bluetooth.service - Bluetooth service
   Loaded: loaded (/lib/systemd/system/bluetooth.service; enabled)
   Active: active (running) since Thu 2017-08-03 20:52:34 EDT; 39min ago
     Docs: man:bluetoothd(8)
 Main PID: 1488 (bluetoothd)
   Status: "Running"
   CGroup: /system.slice/bluetooth.service
           └─1488 /usr/libexec/bluetooth/bluetoothd

Aug 03 20:52:34 BlueRPi bluetoothd[1488]: Bluetooth daemon 5.46
Aug 03 20:52:34 BlueRPi systemd[1]: Started Bluetooth service.
Aug 03 20:52:34 BlueRPi bluetoothd[1488]: Starting SDP server
Aug 03 20:52:34 BlueRPi bluetoothd[1488]: Bluetooth management interface 1.14 initialized
Aug 03 21:32:04 BlueRPi systemd[1]: Started Bluetooth service.

# reset your bluetooth adaptor (good to do when things stop working)
sudo hciconfig hci0 reset

# perfrom a scan to to test
$ bluetoothctl
[NEW] Controller B8:27:EB:F3:A4:64 BlueRPi [default]
Agent registered
[bluetooth]# scan on
Discovery started
[CHG] Controller B8:27:EB:F3:A4:64 Discovering: yes
[NEW] Device F4:F5:D8:4D:34:DB F4-F5-D8-4D-34-DB
[NEW] Device C8:E6:0B:6F:24:D0 EST
[NEW] Device C2:E4:47:7F:F9:95 EST
[NEW] Device F1:08:05:03:41:CE EST
[CHG] Device F4:F5:D8:4D:34:DB ManufacturerData Key: 0x00e0
[CHG] Device F4:F5:D8:4D:34:DB ManufacturerData Value: 0x01
[CHG] Device F4:F5:D8:4D:34:DB ManufacturerData Value: 0x5f
[CHG] Device F4:F5:D8:4D:34:DB ManufacturerData Value: 0xca
[CHG] Device F4:F5:D8:4D:34:DB ManufacturerData Value: 0x66
[CHG] Device F4:F5:D8:4D:34:DB ManufacturerData Value: 0x9a
[CHG] Device F4:F5:D8:4D:34:DB ManufacturerData Value: 0x6d
[CHG] Device C8:E6:0B:6F:24:D0 RSSI: -74
[CHG] Device C8:E6:0B:6F:24:D0 UUIDs: 0000180f-0000-1000-8000-00805f9b34fb
[CHG] Device C8:E6:0B:6F:24:D0 ServiceData Key: 0000180a-0000-1000-8000-00805f9b34fb
[CHG] Device C8:E6:0B:6F:24:D0 ServiceData Value: 0xd0
   .
   .
   .
```

################################################################################
Wihtin bluetoothctrl I get "Failed to start discovery: org.bluez.Error.NotReady" - https://docs.ubuntu.com/core/en/stacks/bluetooth/bluez/docs/troubleshoot/faq


I get within bluetoothctl "Controller AA:AA:AA:AA:AA:AA"
- https://www.raspberrypi.org/forums/viewtopic.php?f=28&t=178356
- https://www.raspberrypi.org/forums/viewtopic.php?f=66&t=176348
################################################################################

### Step X:
Now `reboot` to make sure that the Bluetooth daemon is start
when your Raspberry Pi is rebooted.

```bash
# check to see if the daemon is running
systemctl status bluetooth
```

I get the following for some reason

```bash
$ sudo systemctl status bluetooth
● bluetooth.service - Bluetooth service
   Loaded: loaded (/lib/systemd/system/bluetooth.service; enabled)
   Active: active (running) since Thu 2017-08-03 22:03:05 EDT; 1min 48s ago
     Docs: man:bluetoothd(8)
 Main PID: 677 (bluetoothd)
   Status: "Running"
   CGroup: /system.slice/bluetooth.service
           └─677 /usr/libexec/bluetooth/bluetoothd --experimental

Aug 03 22:03:05 BlueRPi bluetoothd[677]: Bluetooth daemon 5.46
Aug 03 22:03:05 BlueRPi systemd[1]: Started Bluetooth service.
Aug 03 22:03:05 BlueRPi bluetoothd[677]: Starting SDP server
Aug 03 22:03:05 BlueRPi bluetoothd[677]: Bluetooth management interface 1.14 initialized
Aug 03 22:03:05 BlueRPi bluetoothd[677]: Failed to set privacy: Rejected (0x0b)
```
To get a clean message, do the following:

```bash
```

### Step X: Test Bluetooth Daemon D-Bus
This is from - https://gist.github.com/larsblumberg/2335c0ba97f805a2b996f1a7c3ac9571#file-gistfile1-txt-L36

```bash
# install dbus-python
sudo apt-get install -y python-dev libdbus-1-dev libdbus-glib-1-dev python-gi python-pip
sudo python2.7 -m pip install dbus-python

# run tests (it's inside bluez-5.46 folder)
cd ~/src/bluez-5.46/test/
sudo python test-discovery
```

### Step X: Intall X Window Tools

```bash
sudo apt-get install blueman
```

### Step X:
### Step X:

### Starting & Stopping Bluetooth
BlueZ install a daemon called `bluetoothd`,
which manages all the Bluetooth devices.
You can find about the only documentation concerning this daemon
with `man bluetoothd`.

```bash
# stop bluetooth
sudo systemctl stop bluetooth

# start bluetooth
sudo systemctl start bluetooth

# to query the bluetooth status
systemctl status bluetooth

# reset your bluetooth adaptor (good to do when things stop working)
sudo hciconfig hci0 reset
```

## Install bluez-tools
A set of tools to manage bluetooth devices for linux

* https://code.google.com/archive/p/bluez-tools/

## New Section

### HCI Device Configuration Utility (hciconfig)
This tools is used to interrogate and control you local Bluetooth adaptor.
It operates very similarly to `ifconfig` in Linux,
except that it operates on the Bluetooth devices.

```bash
# list hciconfig commands
$ hciconfig --help
hciconfig - HCI device configuration utility
Usage:
	hciconfig
	hciconfig [-a] hciX [command ...]
Commands:
	up                 	Open and initialize HCI device
	down               	Close HCI device
	reset              	Reset HCI device
	rstat              	Reset statistic counters
	auth               	Enable Authentication
	noauth             	Disable Authentication
	encrypt            	Enable Encryption
	noencrypt          	Disable Encryption
	piscan             	Enable Page and Inquiry scan
	noscan             	Disable scan
	iscan              	Enable Inquiry scan
	pscan              	Enable Page scan
	ptype      [type]  	Get/Set default packet type
	lm         [mode]  	Get/Set default link mode
	lp         [policy]	Get/Set default link policy
	name       [name]  	Get/Set local name
	class      [class] 	Get/Set class of device
	voice      [voice] 	Get/Set voice setting
	iac        [iac]   	Get/Set inquiry access code
	inqtpl     [level] 	Get/Set inquiry transmit power level
	inqmode    [mode]  	Get/Set inquiry mode
	inqdata    [data]  	Get/Set inquiry data
	inqtype    [type]  	Get/Set inquiry scan type
	inqparms   [win:int]	Get/Set inquiry scan window and interval
	pageparms  [win:int]	Get/Set page scan window and interval
	pageto     [to]    	Get/Set page timeout
	afhmode    [mode]  	Get/Set AFH mode
	sspmode    [mode]  	Get/Set Simple Pairing Mode
	aclmtu     <mtu:pkt>	Set ACL MTU and number of packets
	scomtu     <mtu:pkt>	Set SCO MTU and number of packets
	delkey     <bdaddr>	Delete link key from the device
	oobdata            	Get local OOB data
	commands           	Display supported commands
	features           	Display device features
	version            	Display version information
	revision           	Display revision information
	block      <bdaddr>	Add a device to the blacklist
	unblock    <bdaddr>	Remove a device from the blacklist
	lerandaddr <bdaddr>	Set LE Random Address
	leadv      [type]  	Enable LE advertising
			0 - Connectable undirected advertising (default)
			3 - Non connectable undirected advertising
	noleadv            	Disable LE advertising
	lestates           	Display the supported LE states
```

```bash
# start up the bluetooth adaptor
sudo hciconfig hci0 up

# list your bluetooth adaptors
$ hciconfig hci0
hci0:	Type: BR/EDR  Bus: UART
	BD Address: B8:27:EB:F3:A4:64  ACL MTU: 1021:8  SCO MTU: 64:1
	UP RUNNING
	RX bytes:143890 acl:0 sco:0 events:4019 errors:0
	TX bytes:14750 acl:0 sco:0 commands:1495 errors:0

# list all the information for your bluetooth adaptors
$ hciconfig -a hci0
hci0:	Type: BR/EDR  Bus: UART
	BD Address: B8:27:EB:F3:A4:64  ACL MTU: 1021:8  SCO MTU: 64:1
	UP RUNNING
	RX bytes:990 acl:0 sco:0 events:44 errors:0
	TX bytes:1508 acl:0 sco:0 commands:44 errors:0
	Features: 0xbf 0xfe 0xcf 0xfe 0xdb 0xff 0x7b 0x87
	Packet type: DM1 DM3 DM5 DH1 DH3 DH5 HV1 HV2 HV3
	Link policy: RSWITCH SNIFF
	Link mode: SLAVE ACCEPT
	Name: 'BlueRPi'
	Class: 0x000000
	Service Classes: Unspecified
	Device Class: Miscellaneous,
	HCI Version: 4.1 (0x7)  Revision: 0xb6
	LMP Version: 4.1 (0x7)  Subversion: 0x2209
	Manufacturer: Broadcom Corporation (15)

# print just the bluetooth version information
$ hciconfig -a hci0 version
hci0:	Type: BR/EDR  Bus: UART
	BD Address: B8:27:EB:F3:A4:64  ACL MTU: 1021:8  SCO MTU: 64:1
	HCI Version: 4.1 (0x7)  Revision: 0xb6
	LMP Version: 4.1 (0x7)  Subversion: 0x2209
	Manufacturer: Broadcom Corporation (15)

# reset your bluetooth adaptor (good to do when things stop working)
sudo hciconfig hci0 reset
```

### - HCI UART Driver Initialization Utility (hciattach)
A simple utility that initializes a given serial port.
Using this tool you can add/delete UART devices without restarting `hcid`.

### Host Controller Interface Tool (hcitool)
[`hcitool`][77] is the host controller interface (HCI) tool
used detect and connect to remote devices, to configure Bluetooth connections,
and send some special command to Bluetooth devices.
Its sort of a swiss army knife for Bluetooth in Linux.

```bash
# list hcitool classic and BLE bluetooth commands
$ sudo hcitool --help
hcitool - HCI Tool ver 5.23
Usage:
	hcitool [options] <command> [command parameters]
Options:
	--help	Display help
	-i dev	HCI device
Commands:
	dev 	Display local devices
	inq 	Inquire remote devices
	scan	Scan for remote devices
	name	Get name from remote device
	info	Get information from remote device
	spinq	Start periodic inquiry
	epinq	Exit periodic inquiry
	cmd 	Submit arbitrary HCI commands
	con 	Display active connections
	cc  	Create connection to remote device
	dc  	Disconnect from remote device
	sr  	Switch master/slave role
	cpt 	Change connection packet type
	rssi	Display connection RSSI
	lq  	Display link quality
	tpl 	Display transmit power level
	afh 	Display AFH channel map
	lp  	Set/display link policy settings
	lst 	Set/display link supervision timeout
	auth	Request authentication
	enc 	Set connection encryption
	key 	Change connection link key
	clkoff	Read clock offset
	clock	Read local or remote clock
	lescan	Start LE scan
	lewladd	Add device to LE White List
	lewlrm	Remove device from LE White List
	lewlsz	Read size of LE White List
	lewlclr	Clear LE White list
	lecc	Create a LE Connection
	ledc	Disconnect a LE Connection
	lecup	LE Connection Update

For more information on the usage of each command use:
	hcitool <command> --help
```

To find out what Bluetooth devices are install on your the Raspberry Pi:

```bash
# list bluetooth device
$ sudo hcitool dev
Devices:
	hci0	B8:27:EB:F3:A4:64
```

To scan for devices, you can use `sudo hcitool scan` but to focus on BLE device
you should `sudo hcitool lescan`.

```bash
# get information on scaning for BLE devices
$ sudo hcitool lescan --help
Usage:
	lescan [--privacy] enable privacy
	lescan [--passive] set scan type passive (default active)
	lescan [--whitelist] scan for address in the whitelist only
	lescan [--discovery=g|l] enable general or limited discoveryprocedure
	lescan [--duplicates] don't filter duplicates# scan for any BLE devices

# scan for non-BLE bluetooth devices
hcitool -i hci0 scan
Scanning ...
	CC:6D:A0:BA:03:8C	Roku Player

# scan for BLE devices but don't show duplicates
$ sudo hcitool -i hci0 lescan
LE Scan ...
C2:E4:47:7F:F9:95 (unknown)
F1:08:05:03:41:CE (unknown)
E8:C9:45:BC:BE:34 Thingy:5
F4:F5:D8:4D:34:DB (unknown)
E8:C9:45:BC:BE:36 (unknown)
C8:E6:0B:6F:24:D0 (unknown)
E8:C9:45:BC:BE:34 (unknown)
F4:F5:D8:4D:34:DB (unknown)

# scan for BLE devices and show the continious advertising activity
$ sudo hcitool lescan --duplicates
LE Scan ...
F4:F5:D8:4D:34:DB (unknown)
F4:F5:D8:4D:34:DB (unknown)
F4:F5:D8:4D:34:DB (unknown)
E8:C9:45:BC:BE:34 Thingy:5
E8:C9:45:BC:BE:34 (unknown)
E8:C9:45:BC:BE:36 (unknown)
F4:F5:D8:4D:34:DB (unknown)
C2:E4:47:7F:F9:95 (unknown)
F4:F5:D8:4D:34:DB (unknown)
F4:F5:D8:4D:34:DB (unknown)
E8:C9:45:BC:BE:34 Thingy:5
E8:C9:45:BC:BE:34 (unknown)
F4:F5:D8:4D:34:DB (unknown)
F4:F5:D8:4D:34:DB (unknown)
F1:08:05:03:41:CE (unknown)
F1:08:05:03:41:CE EST
     .
     .
     .
```

Now lets connect to the BLE device `Thingy:5`:

```bash
# print some info about connecting with BLE device
$ sudo hcitool lecc --help
Usage:
	lecc [--random] <bdaddr>
	lecc --whitelist

# print some info about disconnecting from a BLE device
$ sudo hcitool ledc --help
Usage:
	ledc <handle> [reason]

# connect with the BLE device
# errors out because device doesn't have a public device address
$ sudo hcitool lecc E8:C9:45:BC:BE:34
Could not create connection: Input/output error

sudo hcitool lecc --random E8:C9:45:BC:BE:34
Connection handle 64

# disconnect from BLE device (need handle from initial connection)
sudo hcitool ledc 64
```

### Host Controller Interface Sniffer (hcidump)
This tool enables us to sniff the Bluetooth communication.

`hcidump` doesn't come pre-installed on the Raspberry Pi 3
but can be installed via `sudo apt-get install bluez-hcidump`.

[Tracing Bluetooth With Wireshark and Hcidump](http://mobilesociety.typepad.com/mobile_life/2014/01/tracing-bluetooth-with-wireshark-and-hcidump.html)

```bash
# print information about hcidump command line parameters
$ hcidump --help
Usage: hcidump [OPTION...] [filter]
  -i, --device=hci_dev       HCI device
  -l, --snap-len=len         Snap len (in bytes)
  -p, --psm=psm              Default PSM
  -m, --manufacturer=compid  Default manufacturer
  -w, --save-dump=file       Save dump to a file
  -r, --read-dump=file       Read dump from a file
  -t, --ts                   Display time stamps
  -a, --ascii                Dump data in ascii
  -x, --hex                  Dump data in hex
  -X, --ext                  Dump data in hex and ascii
  -R, --raw                  Dump raw data
  -C, --cmtp=psm             PSM for CMTP
  -H, --hcrp=psm             PSM for HCRP
  -O, --obex=port            Channel/PSM for OBEX
  -P, --ppp=channel          Channel for PPP
  -S, --sap=channel          Channel for SAP
  -D, --pppdump=file         Extract PPP traffic
  -A, --audio=file           Extract SCO audio data
  -Y, --novendor             No vendor commands or events
  -h, --help                 Give this help list
  -v, --version              Give version information
      --usage                Give a short usage message
```

```bash
$ sudo hcitool lecc --random E8:C9:45:BC:BE:34
Connection handle 64

$ hcidump -i hci0 -X
HCI sniffer - Bluetooth packet analyzer ver 5.23
device: hci0 snap_len: 1500 filter: 0xffffffff
```

### Bluetooth Service Discovery (sdptool)
* Bluetooth Recon With BlueZ - http://blog.ice9.us/2014/02/bluetooth-recon-with-bluez.html
* btclassify - https://github.com/mikeryan/btclassify

### Bluetooth Service Discovery (sdptool)
It is crucial to know what you can do with your Bluetooth enabled devices.
You can do this with the `sdptool` command,
which is used for performing SDP queries on Bluetooth devices.

```bash
# list sdptool command options
$ sdptool --help
sdptool - SDP tool v5.23
Usage:
	sdptool [options] <command> [command parameters]
Options:
	-h		Display help
	-i		Specify source interface
Commands:
	search		Search for a service
	browse		Browse all available services
	records		Request all records
	add 		Add local service
	del 		Delete local service
	get 		Get local service
	setattr		Set/Add attribute to a SDP record
	setseq		Set/Add attribute sequence to a SDP record

Services:
	DID SP DUN LAN FAX OPUSH FTP PRINT HS HSAG HF HFAG SAP PBAP NAP
	GN PANU HCRP HID KEYB WIIMOTE CIP CTP A2SRC A2SNK AVRCT AVRTG
	UDIUE UDITE SEMCHLA SR1 SYNCML SYNCMLSERV ACTIVESYNC HOTSYNC
	PALMOS NOKID PCSUITE NFTP NSYNCML NGAGE APPLE IAP ISYNC GATT
```

```bash
# connect to the BLE device
$ sudo hcitool lecc --random E8:C9:45:BC:BE:34
Connection handle 64

sdptool browse E8:C9:45:BC:BE:34
sdptool -i hci0 browse E8:C9:45:BC:BE:34
```

### L2CAP Ping (l2ping)
`l2ping` sends a L2CAP echo request to a Bluetooth MAC address.
This is agnologis to the TCP/IP `ping` command but for Bluetooth.

The [Logical Link Control and Adaptation Layer Protocol (L2CAP)][81]
is layered over the Baseband Protocol and resides in the data link layer.
L2CAP provides connection-oriented and connectionless data services to
upper layer protocols with protocol multiplexing capability,
segmentation and reassembly operation, and group abstractions.

```bash
# list l2ping command options
$ l2ping
l2ping - L2CAP ping
Usage:
	l2ping [-i device] [-s size] [-c count] [-t timeout] [-d delay] [-f] [-r] [-v] <bdaddr>
	-f  Flood ping (delay = 0)
	-r  Reverse ping
	-v  Verify request and response payload
```

```bash
# pinging BD_ADDR
$ sudo l2ping B8:27:EB:F3:A4:64
Can't connect: No route to host
```

### L2CAP Testing (l2test)

### SCO Testing (scotest)

### Connecting & Pairing (rfcomm)
Bluetooth Radio Frequency Communication (RFCOMM) is a simple set of transport protocols,
made on top of the L2CAP protocol,
providing emulated RS-232 serial ports.

```bash
$ rfcomm -h
RFCOMM configuration utility ver 5.23
Usage:
	rfcomm [options] <command> <dev>

Options:
	-i, --device [hciX|bdaddr]     Local HCI device or BD Address
	-h, --help                     Display help
	-r, --raw                      Switch TTY into raw mode
	-A, --auth                     Enable authentication
	-E, --encrypt                  Enable encryption
	-S, --secure                   Secure connection
	-M, --master                   Become the master of a piconet
	-L, --linger [seconds]         Set linger timeout
	-a                             Show all devices (default)

Commands:
	bind     <dev> <bdaddr> [channel]	Bind device
	release  <dev>                   	Release device
	show     <dev>                   	Show device
	connect  <dev> <bdaddr> [channel]	Connect device
	listen   <dev> [channel [cmd]]   	Listen
	watch    <dev> [channel [cmd]]   	Watch
```

* https://www.youtube.com/watch?v=DmtJBc229Rg
* [How to pair a bluetooth device from command line on Linux](http://www.heatxsink.com/entry/how-to-pair-a-bluetooth-device-from-command-line-on-linux)

### Generic Attribute Profile Tool (gatttool)
The gatttool utility can make connections to BLE devices and
is used to access the [services][80] running on your bluetooth device.

* YES = Is it true that - The “gatttool” is deprecated and will be removed soon, then we need to use "bluetoothctl" instead!
* YES = hcitool and gatttool are deprecated. You may want to use bluetoothctl or any newer tooling such as btmgmt included in newer releases of BlueZ
* ArchWiki listed gatttool as deprecated and lists btgatt-client the D-Bus Gatt API as replacement.

```bash
# list gatttool command options
$ sudo gatttool --help-all
Usage:
  gatttool [OPTION...]

Help Options:
  -h, --help                                Show help options
  --help-all                                Show all help options
  --help-gatt                               Show all GATT commands
  --help-params                             Show all Primary Services/Characteristics arguments
  --help-char-read-write                    Show all Characteristics Value/Descriptor Read/Write arguments

GATT commands
  --primary                                 Primary Service Discovery
  --characteristics                         Characteristics Discovery
  --char-read                               Characteristics Value/Descriptor Read
  --char-write                              Characteristics Value Write Without Response (Write Command)
  --char-write-req                          Characteristics Value Write (Write Request)
  --char-desc                               Characteristics Descriptor Discovery
  --listen                                  Listen for notifications and indications

Primary Services/Characteristics arguments
  -s, --start=0x0001                        Starting handle(optional)
  -e, --end=0xffff                          Ending handle(optional)
  -u, --uuid=0x1801                         UUID16 or UUID128(optional)

Characteristics Value/Descriptor Read/Write arguments
  -a, --handle=0x0001                       Read/Write characteristic by handle(required)
  -n, --value=0x0001                        Write characteristic value (required for write operation)

Application Options:
  -i, --adapter=hciX                        Specify local adapter interface
  -b, --device=MAC                          Specify remote Bluetooth address
  -t, --addr-type=[public | random]         Set LE address type. Default: public
  -m, --mtu=MTU                             Specify the MTU size
  -p, --psm=PSM                             Specify the PSM for GATT/ATT over BR/EDR
  -l, --sec-level=[low | medium | high]     Set security level. Default: low
  -I, --interactive                         Use interactive mode
```

Once your running `gatttool`,
you can request information about the command available in interactive mode
by typing `help`.

```bush
# once your running gatttool, you request its interactive commands
$ gatttool -I -t random -b E8:C9:45:BC:BE:34
[E8:C9:45:BC:BE:34][LE]> help
help                                           Show this help
exit                                           Exit interactive mode
quit                                           Exit interactive mode
connect         [address [address type]]       Connect to a remote device
disconnect                                     Disconnect from a remote device
primary         [UUID]                         Primary Service Discovery
included        [start hnd [end hnd]]          Find Included Services
characteristics [start hnd [end hnd [UUID]]]   Characteristics Discovery
char-desc       [start hnd] [end hnd]          Characteristics Descriptor Discovery
char-read-hnd   <handle>                       Characteristics Value/Descriptor Read by handle
char-read-uuid  <UUID> [start hnd] [end hnd]   Characteristics Value/Descriptor Read by UUID
char-write-req  <handle> <new value>           Characteristic Value Write (Write Request)
char-write-cmd  <handle> <new value>           Characteristic Value Write (No response)
sec-level       [low | medium | high]          Set security level. Default: low
mtu             <value>                        Exchange MTU for GATT/ATT
[E8:C9:45:BC:BE:34][LE]>
```

Once you start `gatttool`, type `connect` to connect to the BLE device.
As long as your BLE device is still advertising,
you should see the device-address-line-prompt change to a purple color.
If you get a message "No route to host (113)",
that means the device is not advertising or you’ve used the wrong address.

```bash
gatttool -I -t random -b E8:C9:45:BC:BE:34
```

### btmon
`btmon` is a useful tool to exam Bluetooth packets.

https://stackoverflow.com/questions/23152592/bluetooth-sniffer-how-can-i-install-btmon-on-raspberry-pi

### Bluetooth Control Tool (blutoothctl)
BlueZ comes with a tool called `bluetoothctl`
which runs as a terminal session.
Its intended to replace many of the tools discribed above.
Like all things BlueZ, it doesn't come with much documentation.
`man bluetoothctl` doesn't give you much all,
but its help command does:

* [bluetoothctl - command-line bluetooth manager](https://www.youtube.com/watch?v=di1tjmmH3Tc)
* [bluetoothctl - Bluetooth Manager - Linux CLI](ps://www.youtube.com/watch?v=CB1E4Ir3AV4&t=306s)

```bash
# run bluetoothctl and get help
$ sudo bluetoothctl
[NEW] Controller B8:27:EB:F3:A4:64 BlueRPi [default]
[bluetooth]# help
Available commands:
  list                       List available controllers
  show [ctrl]                Controller information
  select <ctrl>              Select default controller
  devices                    List available devices
  paired-devices             List paired devices
  power <on/off>             Set controller power
  pairable <on/off>          Set controller pairable mode
  discoverable <on/off>      Set controller discoverable mode
  agent <on/off/capability>  Enable/disable agent with given capability
  default-agent              Set agent as the default one
  scan <on/off>              Scan for devices
  info <dev>                 Device information
  pair <dev>                 Pair with device
  trust <dev>                Trust device
  untrust <dev>              Untrust device
  block <dev>                Block device
  unblock <dev>              Unblock device
  remove <dev>               Remove device
  connect <dev>              Connect device
  disconnect <dev>           Disconnect device
  version                    Display version
  quit                       Quit program
[bluetooth]# exit
[DEL] Controller B8:27:EB:F3:A4:64 BlueRPi [default]
$
```

You can pass commands to bluetoothctl like this:

```
echo -e 'power on\nquit' | bluetoothctl
```

You can even use tab to autocomplete:

```
echo -e 'power on\nconnect \t \nquit' | bluetoothctl
```

bluetoothctl from scripts like this:

```
#!/bin/bash
bluetoothctl << EOF
power on
EOF
```



* [Get Started with Bluetooth Low Energy on Linux](https://www.jaredwolff.com/blog/get-started-with-bluetooth-low-energy/)
* [Using Python, Gatttool and Bluetooth Low Energy with Hexiwear](https://mcuoneclipse.com/2016/12/29/using-python-gatttool-and-bluetooth-low-energy-with-hexiwear/)
* [Using gatttool in a manual/non-interactive mode to read BLE devices](http://www.humbug.in/2014/using-gatttool-manualnon-interactive-mode-read-ble-devices/)
* [Bluetooth BLE, gatttool and (almost) all those numbers .... explained](http://blog.firszt.eu/index.php?post/2015/09/13/bt)
* [Bluetooth developer studio & plugins](https://www.bluetooth.com/develop-with-bluetooth/developer-resources-tools/developer-kits/bluetooth-developer-plugins)
* [Bluetooth Developer Kits](https://www.bluetooth.com/develop-with-bluetooth/developer-resources-tools/developer-kits)
* [nRF52 Software Development Kit (SDK)](https://developer.nordicsemi.com/)
provides source code of examples and libraries forming the base of your application development
* [Control a Bluetooth LE Light Bulb With Raspberry Pi](https://www.hackster.io/idreams/control-a-bluetooth-le-light-bulb-with-raspberry-pi-6d04cc)
* [Adafruit’s Feather nRF52840 Express Board and Developing with CircuitPython](https://blog.nordicsemi.com/getconnected/adafruits-feather-nrf52840-express-board-and-developing-with-circuitpython)

## Bluetooth LE with Python (bluepy)
Using `gatttool` is very laborious for doing any useful work,
so it's a good idea to use a programming language.
The `bluepy` Python package is one way to use Bluetooth LE on the commandline.

Mmake sure you already have the requred packages and then install `bluepy`.

```bash
# install dependancies
sudo apt-get install python-pip libglib2.0-dev

# install the bluepy package
 sudo pip install bluepy
```

The `blescan` program performs a similar function to `hcitool lescan`
but produces more information.

* http://www.elinux.org/RPi_Bluetooth_LE
* https://learn.adafruit.com/bluefruit-le-python-library/overview?gclid=CjwKEAjw16HLBRDF9L2UmOCH7U8SJAASVESoJma_G4MQgd_PV-pfXfLn6ldmofVhCDTCqoQrWLNDgBoCU4Hw_wcB
* http://blog.kevindoran.co/bluetooth-programming-with-python-3/

## Adafruit Bluetooth LE Friend
The [Adafruit Bluetooth LE Friend][39] is a USB-to-BLE board that makes it easy
to get your computer talking to your BLE enabled device using a standard serial/UART connection.
It works on the same principle as a common USB/Serial adapter (e.g. [FTDI Friend][40]).
Data entered (e.g. terminal emulator) on your development machines serial port
will be transferred over the air to the connected Bluetooth device,
and vice versa, as a basic 'UART' connection.
This Adafruit device use the Nordic [nRF51822][42] SoC is enbedded with a ARM Cortex M0 CPU and
2.4GHz transceiver supports both Bluetooth low energy
and the proprietary [Nordic Gazell 2.4 GHz protocol stack][41].

You might be thinking my computer already has Bluetooth, so why use this?
You can get a Bluetooth 4.0 USB dongle from the store already,
but some OS' doesn't support Bluetooth Low Energy natively (e.g. Windows 7),
and on other OS' have to sort through API documentation, development tools, etc.
Generally, you can't just connect wirelessly without difficulty because
there isn't a standard, open source, cross-platform way to talk BLE today.
But hte Bluefruit Friend provides this.
It has a full BLE peripheral stack and interface software
so that you can treat your BLE connection just like a UART connection.
Therefore you can use terminal software or scripting software like python (with pySerial).
Using Bluefruit LE Friend, you'er up and running on just about anything with a USB port,
with easy migration across platforms and operating systems.

And you canot talk to Classic Bluetooth devices with a Bluefruit LE modules.
Bluetooth Low Energy and 'Classic' Bluetooth are both part of the same Bluetooth Core Specification
(defined and maintained by the Bluetooth SIG)
but they are completely different protocols operating with different physical constraints and requirements.
The two protocols can't talk to each other directly.

And the Adafruit Bluefruit LE module cannot connect to other Bluefruit LE peripherals.
The Bluefruit LE firmware from Adafruit is currently peripheral only,
and doesn't run in Central mode,
which would cause the module to behave similar to your mobile phone or BLE enabled laptop.

If you required Central support,
you'll need a device with something like the [Nordic nRF52832 SoC][48],
a products like the [Adafruit Feather nRF52 Bluefruit LE][71],
which contains a SoftDevice which is capable of running in either Central or Peripheral mode.
The nRF518322 based products, Adafruit Bluetooth LE Friend, are not capable of running in Central mode.

### Adafruit Bluefruit LE Connect
Via the [Adafruit Bluefruit LE Connect][43] mobile app,
you can wirelessly connect your Android device to an Adafruit Bluefruit LE module
for control & communication with your project
(there is also a [iOS version][44]).

https://learn.adafruit.com/bluefruit-le-connect-for-ios/settings

> **NOTE:**
[The Adafruit Bluefruit LE Connec tapp is compatible with several other BLE devices from Adafruit][45].

### Firmware Update
You can update the Adafruit Bluetooth LE Friend firmware over-the-air but not over the USB/UART connection.
To update the firmware, you use the Adafruit Bluefruit LE Connect phone app.

* [Introducing the Adafruit Bluefruit LE Friend](https://learn.adafruit.com/introducing-adafruit-ble-bluetooth-low-energy-friend)
* [Bluefruit LE Python Library](https://learn.adafruit.com/bluefruit-le-python-library)

## Red Bear Lab BLE
There are [three options][25] to program your [BLE Nano with MK20 USB board][24]:

1. [Arduino Library for nRF51822](https://github.com/RedBear/nRF51822-Arduino)
    * Video Tutorial: [RedBear BLE Nano Quick Start with Arduino IDE](https://www.youtube.com/watch?v=d75strWav5k&feature=youtu.be)
1. [Nordic nRF51822 BLE SDK](https://developer.nordicsemi.com)
1. [mbed's Bluetooth Low Energy API](http://developer.mbed.org/teams/RedBearLab/)

While it is possible to upload firmware to a BLE Nano without using a MK20 USB board,
(via special debugger hardware [JLink][23]),
most instructions for the BLE Nano assumes you have a MK20 USB board by RedBearLab.

Nordic [nRF51822 SoC][21] supports Bluetooth low energy protocol stacks
and is built around a 32-bit ARM Cortex M0 CPU with 256kB/128kB flash + 32kB/16kB RAM
The embedded 2.4GHz transceiver supports both Bluetooth low energy
and the [Nordic Gazell 2.4 GHz protocol stack][22] which is on air compatible
with the nRF24L series products from Nordic Semiconductor.

[RedBear IoT pHAT provides both BLE and WiFi](https://redbear.cc/product/rpi/iot-phat.html),
designed for the Raspberry Pi Zero (other RPi boards with 40-pin header will also work).


* [RedBearLab Discussion forum](http://discuss.redbear.cc/)

## Raspberry Pi
The newest device from the Raspberry Pi Foundation, Raspberry Pi 3 Model B,
comes with both built-in WiFi and Bluetooth 4.1.
The ultimate goal of this section is to setup the Raspberry Pi to read/write data
from connected BLE devices.

### Step 1: Turn on Bluetooth
Both the Raspberry Pi 3 and the Raspberry Pi Zero W have Bluetooth
pre-loaded and should working "out of the box".
To validate that Bluetooth is operation,
enter `systemctl status bluetooth` it should show "running".
If its not active, try strating the service with `sudo systemctl start bluetooth`
and if that fails, check out the article
"[How to setup Bluetooth on a Raspberry Pi 3][75]" or
"[Everything You Need to Set Up Bluetooth on the Raspberry Pi 3][76]" or
""[Setting up Bluetooth on the Raspberry Pi 3][78]".

Here is some additional testing you can perform:

```bash
# validate bluetooth is running
$ systemctl status bluetooth
● bluetooth.service - Bluetooth service
   Loaded: loaded (/lib/systemd/system/bluetooth.service; enabled)
   Active: active (running) since Thu 2017-04-27 12:36:06 EDT; 2 months 16 days ago
     Docs: man:bluetoothd(8)
 Main PID: 767 (bluetoothd)
   Status: "Running"
   CGroup: /system.slice/bluetooth.service
           └─767 /usr/lib/bluetooth/bluetoothd

# get the BD address of the raspberry pi
$ hciconfig
hci0:	Type: BR/EDR  Bus: UART
	BD Address: B8:27:EB:F3:A4:64  ACL MTU: 1021:8  SCO MTU: 64:1
	UP RUNNING
	RX bytes:717 acl:0 sco:0 events:42 errors:0
	TX bytes:1532 acl:0 sco:0 commands:42 errors:0
```

> **NOTE: If you get the error message: "Sap driver initialization failed."
check out [SAP error on bluetooth service status][74],
but it should not be a problem to ignore.

You can stop the Bluetooth service by running by `sudo systemctl stop bluetooth`.
You probably want the Bluetooth service to run automatically when the Raspberry Pi boots
you can enable this via `sudo systemctl enable bluetooth`
or disable this via `sudo systemctl disable bluetooth`.

### Step X: Raspberry Pi 3 as a Beacon Scanner
* [iBeacon Raspberry Pi Scanner in Python](http://www.switchdoc.com/2014/08/ibeacon-raspberry-pi-scanner-python/)
* [Beacon tracking with Node.js and Raspberry Pi](https://blog.truthlabs.com/beacon-tracking-with-node-js-and-raspberry-pi-794afa880318#.dpvrsy7gb)
* [Immersive Theatre via iBeacons with Dustin Freeman](http://hackaday.com/2015/12/18/immersive-theatre-via-ibeacons-with-dustin-freeman/)

Lets first scan for Bluetooth Classic device (aka non-BLE device)
and then for BLE devices:

```bash
# get the BD address of the advertised classic devices in range
$ hcitool scan
Scanning ...
	CC:6D:A0:BA:03:8C	Roku Player

# get the BD address of the advertised BLE devices in range
$ sudo hcitool lescan
LE Scan ...
C2:E4:47:7F:F9:95 (unknown)
F4:F5:D8:4D:34:DB (unknown)
F4:F5:D8:4D:34:DB (unknown)
F1:08:05:03:41:CE (unknown)
F1:08:05:03:41:CE EST
C8:E6:0B:6F:24:D0 (unknown)
C8:E6:0B:6F:24:D0 EST
C2:E4:47:7F:F9:95 EST
E8:C9:45:BC:BE:36 (unknown)
E8:C9:45:BC:BE:34 Thingy:5
E8:C9:45:BC:BE:34 (unknown)

# scan for BLE devices and show the continious advertising activity
sudo hcitool lescan --duplicates
```

The above scan command `sudo hcitool lescan --duplicates`
lets you see the BLE device advertising dynamically coming in.
To get a moree detail view, use `bluetoothctl`:

```bash
# scan continuiously for devices
$ sudo bluetoothctl
[NEW] Controller B8:27:EB:F3:A4:64 BlueRPi [default]
[bluetooth]# scan on
Discovery started
[CHG] Controller B8:27:EB:F3:A4:64 Discovering: yes
[NEW] Device C8:E6:0B:6F:24:D0 EST
[NEW] Device 58:07:16:66:4A:79 58-07-16-66-4A-79
[NEW] Device F1:08:05:03:41:CE EST
[NEW] Device CC:6D:A0:BA:03:8C Roku Player
[CHG] Device C8:E6:0B:6F:24:D0 RSSI: -76
[CHG] Device C8:E6:0B:6F:24:D0 UUIDs:
	0000180f-0000-1000-8000-00805f9b34fb
[NEW] Device C2:E4:47:7F:F9:95 EST
[CHG] Device C2:E4:47:7F:F9:95 RSSI: -67
[CHG] Device C2:E4:47:7F:F9:95 RSSI: -78
[CHG] Device F1:08:05:03:41:CE RSSI: -60
[bluetooth]#
```

With `bluetoothctl` running, you'll will see devices appear, change, delete, etc.

### Step X: Make The Raspberry Pi Discoverable
To make the RPi scanable and found by other devices,
you'll need to do the following:

```bash
# make the device scanable
sudo hciconfig hci0 piscan

# establish a pairing code
sudo bluetooth-agent 1234
```

The `1234` is the pairing code for it to use,
but this will can be automatically overridden by a randomly selected code displayed on both devices.

http://www.raspberry-projects.com/pi/pi-operating-systems/raspbian/bluetooth/bluetooth-commands

### Step X: Control BLE Devices From a Raspberry Pi
Control Bluetooth LE Devices From a Raspberry Pi - http://www.instructables.com/id/Control-Bluetooth-LE-Devices-From-A-Raspberry-Pi/

### Step X: Raspberry Pi 3 as a iBeacon
* [piBeacon - DIY Beacon with a Raspberry Pi](https://learn.adafruit.com/pibeacon-ibeacon-with-a-raspberry-pi/overview)
* [Create an iBeacon Transmitter with the Raspberry Pi](http://www.wadewegner.com/2014/05/create-an-ibeacon-transmitter-with-the-raspberry-pi/)

### Step X: Raspberry Pi 3 as an Eddystone URL Beacon
It is possible to configure a Raspberry Pi 3 to act as an Eddystone beacon.
* [Turn Your RPi 3 Into a BLE Beacon](http://hackaday.com/2016/03/27/turn-your-rpi-3-into-a-ble-beacon/)
* [What is Bluetooth 5 – Gary explains](http://www.androidauthority.com/bluetooth-5-gary-explains-703734/)


## Nordic Thingy:52
Nordic Semiconductor has a single-board Bluetooth 5 development kit
that can be configuration from smartphone apps and the cloud.
It is intended to enables Makers and developers
to quickly design and demonstrate IoT projects,
Called the [Nordic Thingy:52][49]
sensor kit is based on [Nordic’s nRF52832 BLE SoC][48],
which combines a 64MHz 32-bit [ARM Cortex-M4F MCU][57] with a 2.4GHz [multi-protocol][56] radio,
plus 512KB flash memory and 64kB RAM.
This SoC runs Nordic’s S132 SoftDevice,
an RF software ‘stack’ that can support up to 20 concurrent connections
in a variety of BLE role combinations.
It includes a wide range of sensors an capabilities.

The Thingy:52 with its Nordic nRF52832 BLE SoC
can operate as a master or slave Bluetooth device.

* [Getting Started with Bluetooth Low Energy Development](http://cdn2.hubspot.net/hubfs/1961165/eBooks/NordicSemi_eBook_Bluetooth_Low_Energy_development.pdf?__hssc=8439722.21.1498183911767&__hstc=8439722.c9dd4b6d976bf65845653762e20b9b8e.1497729363306.1498098124982.1498183911767.10&__hsfp=3204778181&hsCtaTracking=0c610996-d8ee-40c9-82f4-b4db77681f9b%7Cfe75fcbd-83e6-4bfd-94b3-1c9084f36d86)
* [Nordic Development Zone](https://devzone.nordicsemi.com/questions/)
* [tutorials written by Nordic employees](https://devzone.nordicsemi.com/tutorials/)

* [Create IoT Prototypes With Ease Using the Nordic Thing:52 Dev Kit](https://blog.hackster.io/create-iot-prototypes-with-ease-using-the-nordic-thing-52-dev-kit-824f7d384337)
* [What is the Nordic Thingy:52? – Gary explains](http://www.androidauthority.com/nordic-thingy52-779773/)
    * Nordic Thingy:52 Android SDK and sample app
    * Nordic Thingy:52 Firmware
    * Nordic Thingy:52 Web App
    * Nordic Thingy:52 Nodejs
    * Nordic-Thingy:52 iOS library and sample app
* [Nordic Thingy:91](https://www.nordicsemi.com/Software-and-Tools/Prototyping-platforms/Nordic-Thingy-91)

### Nordic Bluetooth Tools
* nrfjprog, pynrfjprog - Intro, Mac OS X & Linux now supported - https://devzone.nordicsemi.com/blogs/840/nrfjprog-pynrfjprog-intro-mac-os-x-linux-now-suppo/
* nRF5x-Tools and nRF5x-Pynrfjprog Includes Linux and Python 3 Support - https://devzone.nordicsemi.com/blogs/778/nrf5x-tools-and-nrf5x-pynrfjprog-includes-linux-an/
* Bluefruit nRF52 Feather Learning Guide - https://learn.adafruit.com/bluefruit-nrf52-feather-learning-guide/flashing-the-bootloader

### Step 0: Getting Started with Nordic Thingy:52 IoT Sensor Kit - DONE
Follow the procedures on [Nordic's Thingy:52 Gettting Started page][54].
Using this, you learn how to charge the device,
[download the phone app][55], and to interface with the Thingy:52
via the Nordic provided phone app.

You can also use the web application,
which does not require you to install any software on your mobile device.
Simply scan for the Eddystone beacon advertised by the Thingy and follow the URL.

The Thingy:52 will be beaconing as long as the light is blinking.
Once the device sits still for sometime, the blinking stops and so does the beaconing,
and you can nolonger connect with the device.

### Step X: Other Phone Apps From Nordic
[nRF Connect][58] for mobile generic tool that allows you to scan and explore your
Bluetooth low energy devices and communicate with them.
nRF Connect for mobile supports a number of Bluetooth SIG adopted profiles,
as well as the Device Firmware Update profile (DFU) from Nordic Semiconductor or Eddystone from Google.

The [nRF Toolbox][59] is a container app that stores your Nordic Semiconductor apps for Bluetooth® low energy in one location.The nRF Toolbox works with a wide range of the most popular Bluetooth low energy accessories.It contains applications demonstrating the following profiles: Cycling Speed and Cadence, Running Speed and Cadence, Heart Rate Monitor, Blood Pressure Monitor, Health Thermometer Monitor, Glucose Monitor, Proximity Monitor and Nordic UART.The Device Firmware Update (DFU) app, which is also included, allows you to upload the application image Over-the-air (OTA). It is compatible with Nordic Semiconductor nRF5 Series devices that have the SoftDevice and bootloader enabled.

nRF Beacon - https://play.google.com/store/apps/details?id=no.nordicsemi.android.nrfbeacon&hl=en

Beacon Simulator - https://play.google.com/store/apps/details?id=net.alea.beaconsimulator&hl=en

Nordic UART - https://play.google.com/store/apps/details?id=com.nordicsemi.nrfUARTv2&hl=en

Serial Bluetooth Terminal - https://play.google.com/store/apps/details?id=de.kai_morich.serial_bluetooth_terminal&hl=en

### Step X:
Next, lets performing a BLE scanning, to get the MAC address of the Thingy:52 device,
and then query it about its features:

```bash
# BLE scan from linux
$ sudo hcitool lescan
LE Scan ...
F4:F5:D8:4D:34:DB (unknown)
C2:E4:47:7F:F9:95 (unknown)
C2:E4:47:7F:F9:95 EST
F4:F5:D8:4D:34:DB (unknown)
F1:08:05:03:41:CE (unknown)
C8:E6:0B:6F:24:D0 (unknown)
F1:08:05:03:41:CE EST
C8:E6:0B:6F:24:D0 EST
E8:C9:45:BC:BE:36 (unknown)
E8:C9:45:BC:BE:34 Thingy:5
E8:C9:45:BC:BE:34 (unknown)

# get attribute and characteristics information about the device
$ gatttool -I -t random -b E8:C9:45:BC:BE:34
[E8:C9:45:BC:BE:34][LE]> connect
Attempting to connect to E8:C9:45:BC:BE:34
Connection successful
[E8:C9:45:BC:BE:34][LE]> included
No included services found for this range
[E8:C9:45:BC:BE:34][LE]> primary
attr handle: 0x0001, end grp handle: 0x0009 uuid: 00001800-0000-1000-8000-00805f9b34fb
attr handle: 0x000a, end grp handle: 0x000d uuid: 00001801-0000-1000-8000-00805f9b34fb
attr handle: 0x000e, end grp handle: 0x001c uuid: ef680100-9b35-4933-9b10-52ffa9740042
attr handle: 0x001d, end grp handle: 0x002e uuid: ef680200-9b35-4933-9b10-52ffa9740042
attr handle: 0x002f, end grp handle: 0x004c uuid: ef680400-9b35-4933-9b10-52ffa9740042
attr handle: 0x004d, end grp handle: 0x0054 uuid: ef680300-9b35-4933-9b10-52ffa9740042
attr handle: 0x0055, end grp handle: 0x005f uuid: ef680500-9b35-4933-9b10-52ffa9740042
attr handle: 0x0060, end grp handle: 0x0063 uuid: 0000180f-0000-1000-8000-00805f9b34fb
attr handle: 0x0064, end grp handle: 0xffff uuid: 0000fe59-0000-1000-8000-00805f9b34fb
[E8:C9:45:BC:BE:34][LE]> characteristics
handle: 0x0002, char properties: 0x0a, char value handle: 0x0003, uuid: 00002a00-0000-1000-8000-00805f9b34fb
handle: 0x0004, char properties: 0x02, char value handle: 0x0005, uuid: 00002a01-0000-1000-8000-00805f9b34fb
handle: 0x0006, char properties: 0x02, char value handle: 0x0007, uuid: 00002a04-0000-1000-8000-00805f9b34fb
handle: 0x0008, char properties: 0x02, char value handle: 0x0009, uuid: 00002aa6-0000-1000-8000-00805f9b34fb
handle: 0x000b, char properties: 0x20, char value handle: 0x000c, uuid: 00002a05-0000-1000-8000-00805f9b34fb
handle: 0x000f, char properties: 0x0a, char value handle: 0x0010, uuid: ef680101-9b35-4933-9b10-52ffa9740042
handle: 0x0011, char properties: 0x0a, char value handle: 0x0012, uuid: ef680102-9b35-4933-9b10-52ffa9740042
handle: 0x0013, char properties: 0x0a, char value handle: 0x0014, uuid: ef680104-9b35-4933-9b10-52ffa9740042
handle: 0x0015, char properties: 0x0a, char value handle: 0x0016, uuid: ef680105-9b35-4933-9b10-52ffa9740042
handle: 0x0017, char properties: 0x0a, char value handle: 0x0018, uuid: ef680106-9b35-4933-9b10-52ffa9740042
handle: 0x0019, char properties: 0x02, char value handle: 0x001a, uuid: ef680107-9b35-4933-9b10-52ffa9740042
handle: 0x001b, char properties: 0x0a, char value handle: 0x001c, uuid: ef680108-9b35-4933-9b10-52ffa9740042
handle: 0x001e, char properties: 0x10, char value handle: 0x001f, uuid: ef680201-9b35-4933-9b10-52ffa9740042
handle: 0x0021, char properties: 0x10, char value handle: 0x0022, uuid: ef680202-9b35-4933-9b10-52ffa9740042
handle: 0x0024, char properties: 0x10, char value handle: 0x0025, uuid: ef680203-9b35-4933-9b10-52ffa9740042
handle: 0x0027, char properties: 0x10, char value handle: 0x0028, uuid: ef680204-9b35-4933-9b10-52ffa9740042
handle: 0x002a, char properties: 0x10, char value handle: 0x002b, uuid: ef680205-9b35-4933-9b10-52ffa9740042
handle: 0x002d, char properties: 0x0a, char value handle: 0x002e, uuid: ef680206-9b35-4933-9b10-52ffa9740042
handle: 0x0030, char properties: 0x0a, char value handle: 0x0031, uuid: ef680401-9b35-4933-9b10-52ffa9740042
handle: 0x0032, char properties: 0x10, char value handle: 0x0033, uuid: ef680402-9b35-4933-9b10-52ffa9740042
handle: 0x0035, char properties: 0x10, char value handle: 0x0036, uuid: ef680403-9b35-4933-9b10-52ffa9740042
handle: 0x0038, char properties: 0x10, char value handle: 0x0039, uuid: ef680404-9b35-4933-9b10-52ffa9740042
handle: 0x003b, char properties: 0x10, char value handle: 0x003c, uuid: ef680405-9b35-4933-9b10-52ffa9740042
handle: 0x003e, char properties: 0x10, char value handle: 0x003f, uuid: ef680406-9b35-4933-9b10-52ffa9740042
handle: 0x0041, char properties: 0x10, char value handle: 0x0042, uuid: ef680407-9b35-4933-9b10-52ffa9740042
handle: 0x0044, char properties: 0x10, char value handle: 0x0045, uuid: ef680408-9b35-4933-9b10-52ffa9740042
handle: 0x0047, char properties: 0x10, char value handle: 0x0048, uuid: ef680409-9b35-4933-9b10-52ffa9740042
handle: 0x004a, char properties: 0x10, char value handle: 0x004b, uuid: ef68040a-9b35-4933-9b10-52ffa9740042
handle: 0x004e, char properties: 0x10, char value handle: 0x004f, uuid: ef680302-9b35-4933-9b10-52ffa9740042
handle: 0x0051, char properties: 0x0a, char value handle: 0x0052, uuid: ef680301-9b35-4933-9b10-52ffa9740042
handle: 0x0053, char properties: 0x0a, char value handle: 0x0054, uuid: ef680303-9b35-4933-9b10-52ffa9740042
handle: 0x0056, char properties: 0x0a, char value handle: 0x0057, uuid: ef680501-9b35-4933-9b10-52ffa9740042
handle: 0x0058, char properties: 0x04, char value handle: 0x0059, uuid: ef680502-9b35-4933-9b10-52ffa9740042
handle: 0x005a, char properties: 0x10, char value handle: 0x005b, uuid: ef680503-9b35-4933-9b10-52ffa9740042
handle: 0x005d, char properties: 0x10, char value handle: 0x005e, uuid: ef680504-9b35-4933-9b10-52ffa9740042
handle: 0x0061, char properties: 0x12, char value handle: 0x0062, uuid: 00002a19-0000-1000-8000-00805f9b34fb
handle: 0x0065, char properties: 0x18, char value handle: 0x0066, uuid: 8ec90001-f315-4f60-9fb8-838830daea50
[E8:C9:45:BC:BE:34][LE]>
```

### Step X:
### Step X:
### Step X: Streaming Sound
https://www.youtube.com/watch?v=itXVj17HxJg

# Building BLE Devices
BUILDING BLUETOOTH LE DEVICES - https://www.hardill.me.uk/wordpress/2015/07/28/building-bluetooth-le-devices/
Slave - https://www.npmjs.com/package/bleno
Master - https://github.com/sandeepmistry/noble

# BLE Router
https://infocenter.nordicsemi.com/index.jsp?topic=%2Fcom.nordic.infocenter.iotsdk.v0.9.0%2Fiot_sdk_user_guides_linux_commands.html

# BLE to MQTT Bridge
A BLE to MQTT bridge - https://github.com/shmuelzon/ble2mqtt
A BLE -> MQTT bridge for Raspberry Pi and other Embedded devices - https://github.com/espruino/EspruinoHub

# Bluetooth Primer
* [Primer on Bluetooth Low Energy](http://hackaday.com/2013/08/29/primer-on-bluetooth-low-energy/)
* [How do iBeacons work?](http://www.warski.org/blog/2014/01/how-ibeacons-work/)
* [What is the iBeacon Bluetooth Profile](http://stackoverflow.com/questions/18906988/what-is-the-ibeacon-bluetooth-profile)
* [Hackaday Dictionary: Bluetooth Low Energy](http://hackaday.com/2015/12/02/hackaday-dictionary-bluetooth-low-energy/)
* [How to Build Low-Power Wireless Links for the Internet of Things Using Bluetooth 4.1](http://www.digikey.com/en/articles/techzone/2014/jun/how-to-build-low-power-wireless-links-for-the-internet-of-things-using-bluetooth-41)
* [The Physical Web vs. iBeacons vs. Eddystone vs. IoT](http://www.nanalyze.com/2016/03/the-physical-web-vs-ibeacons-vs-eddystone-vs-iot/)

# Change your bluetooth device mac-address
http://blog.petrilopia.net/linux/change-your-bluetooth-device-mac-address/

# Reverse Engineering IoT Devices
* [Reverse Engineering IoT Devices](https://iayanpahwa.github.io/Reverse-Engineering-IoT-Devices/)

# Bluetooth Programming Concepts
* http://people.csail.mit.edu/rudolph/Teaching/Articles/BTBook.pdf

# Node.js, Noble, Bleno
* [Raspberry Pi BTLE Device](https://blog.cmgresearch.com/2014/05/18/raspberry-pi-btle-device.html)
* [Bluetooth Devices Can Now Be Controlled From The Web Through Node.js](https://arc.applause.com/2016/02/12/bluetooth-gateway-navible-node-js/)
* https://github.com/sandeepmistry/noble

# Bluetooth Secure Gateway Kit
The Bluetooth SIG offers the [Secure Gateway Kit][93] so you can create
a secure connection between Bluetooth low energy devices and a server or cloud computer
without a smartphone or tablet as a go between.
The kit walks you through how to setup the gateway,
its web interface, and navigate your Bluetooth devices services and characteristics in a secure fashion.
You can download the Secure Gateway Kit [here][94] and find other developer tools [here][95].

* [Build A Gateway: Node.js, RESTful Smart Server API](https://arc.applause.com/2016/02/12/bluetooth-gateway-navible-node-js/)
* [RASPBERRY Pi / Bluetooth Secure Gateway](https://medium.com/@maxtsai/raspberry-pi-bluetooth-secure-gateway-1bd6a6b35887)
* [BLUETOOTH SECURE GATEWAY HANDS ON LAB: VERSION 1.0.14, Issued: August 2016](http://www.makerol.net/usr/uploads/2016/11/3814889224.pdf)
* [What is…a GATT Service?](https://www.electronicsweekly.com/blogs/eyes-on-android/what-is/what-is-a-gatt-service-2013-08/)

## Step X: Establish Develop Environment
First, lets establish the codes version control environment.

```bash
# create your project directory
cd ~/src
mkdir ble-gateway

# change to the directory you just created and establish git repository
cd !$
git init

# pull preconfigured .gitignore file
https://gist.githubusercontent.com/jeffskinnerbox/9612119/raw/87844ac7e4233330d5740d0330ea3cf578d19c47/.gitignore
```

Next, set up your coding tools.
This assumes you are using the Node Version Manager (nvm)
and of course the Node Packaged Manager (npm).

```bash
# set your node version
$ nvm use default
Now using node v6.11.1 (npm v3.10.10)

# initialise your node.js and create your project.json
npm init
```

## Step X: Install Gateway Kit
Now download the Secure Gateway Kit software and confiure it for operation.

```bash
# download the kit and unzip it
wget http://downloads.bluetooth.com/tools/SG/smart-gateway-installscript.zip
unzip smart-gateway-installscript.zip
rm smart-gateway-installscript.zip

# update git
git config --global user.email "you@example.com"
git config --global user.name "Your Name"
git add .
git commit -m 'Initial download of Bluetooth Secure Gateway Kit'
```

## Step X: Running the Gateway
```bash
cd gateway
npm install
npm run start
```



[01]:https://google.github.io/physical-web/
[02]:https://phy.net/physical-web-browsers/
[03]:https://www.youtube.com/watch?v=gxPcPXSE_O0
[04]:http://blog.chromium.org/2015/07/exploring-physical-web-with-chrome-for.html
[05]:https://play.google.com/store/apps/details?id=physical_web.org.physicalweb&hl=en
[06]:https://developers.google.com/beacons/?hl=en
[07]:https://github.com/google/eddystone/tree/master/configuration-service
[08]:http://cf.physical-web.org/
[09]:https://play.google.com/store/apps/details?id=no.nordicsemi.android.nrfbeacon.nearby
[10]:https://developers.google.com/nearby/
[11]:https://play.google.com/store/apps/details?id=no.nordicsemi.android.mcp
[12]:https://itunes.apple.com/us/app/nrf-connect/id1054362403
[13]:https://webbluetoothcg.github.io/web-bluetooth/
[14]:https://medium.com/@jyasskin/the-web-bluetooth-security-model-666b4e7eed2#.dwe6oco1t
[15]:http://hackaday.com/2016/09/23/web-bluetooth-the-new-hotness-and-its-dangers/
[16]:https://pomcor.com/2015/06/03/has-bluetooth-become-secure/
[17]:https://www.bluetooth.com/specifications/generic-attributes-overview
[18]:https://www.youtube.com/watch?v=dYj6bpDzID0
[19]:https://lacklustre.net/bluetooth/outsmarting_bluetooth_smart-mikeryan-cansecwest_2014.pdf
[20]:https://www.bluetooth.com/
[21]:https://www.nordicsemi.com/eng/Products/Bluetooth-low-energy/nRF51822
[22]:https://devzone.nordicsemi.com/documentation/nrf51/4.1.0/html/index.html
[23]:https://www.adafruit.com/product/1369
[24]:https://redbear.cc/product/ble/ble-nano-kit.html
[25]:http://redbearlab.com/blenano/
[26]:https://learn.adafruit.com/introduction-to-bluetooth-low-energy/gatt
[27]:https://www.bluetooth.com/specifications/adopted-specifications
[28]:https://www.bluetooth.com/specifications/profiles-overview
[29]:https://www.bluetooth.com/news/pressreleases/2016/12/07/bluetooth-5-now-available
[30]:https://www.youtube.com/watch?v=SynyKRkbLh8
[31]:http://www.connectblue.com/about-us/technologies/classic-bluetooth-technology/
[32]:https://www.youtube.com/watch?v=z6vQ43V4WxA
[33]:https://www.youtube.com/watch?v=gljeNbjym0o
[34]:http://www.bluez.org/
[35]:https://techcrunch.com/2014/11/20/seed-lab-creates-a-seamless-connection-between-you-and-your-kettle/
[36]:http://www.ledsmagazine.com/articles/print/volume-13/issue-3/features/smart-lighting/bluetooth-mesh-what-s-that-noise-about.html
[37]:https://blog.bluetooth.com/trashed
[38]:https://github.com/WebBluetoothCG/web-bluetooth
[39]:https://www.adafruit.com/product/2267
[40]:https://www.adafruit.com/product/284
[41]:https://devzone.nordicsemi.com/documentation/nrf51/4.4.2/html/index.html
[42]:https://www.nordicsemi.com/eng/Products/Bluetooth-low-energy/nRF51822
[43]:https://play.google.com/store/apps/details?id=com.adafruit.bluefruit.le.connect&hl=en
[44]:https://itunes.apple.com/app/adafruit-bluefruit-le-connect/id830125974?mt=8
[45]:https://learn.adafruit.com/bluefruit-le-connect-for-ios/settings
[46]:http://www.wi-fi.org/discover-wi-fi/wi-fi-direct
[47]:http://members.nfc-forum.org/apps/group_public/download.php/18688/NFCForum-AD-BTSSP_1_1.pdf
[48]:http://infocenter.nordicsemi.com/index.jsp?topic=%2Fcom.nordic.infocenter.nrf52%2Fdita%2Fnrf52%2Fchips%2Fnrf52832_ps.html
[49]:https://www.nordicsemi.com/eng/Products/Nordic-Thingy-52
[50]:https://www.nordicsemi.com/eng/Products/Bluetooth-5
[51]:http://www.electronicdesign.com/communications/ble-v42-creating-faster-more-secure-power-efficient-designs-part-1
[52]:https://blog.bluetooth.com/exploring-bluetooth-5-going-the-distance
[53]:http://rfunderstanding.blogspot.com/2013/08/spreading-factor-sf-or-processing-gain.html
[54]:https://www.nordicsemi.com/eng/Products/Getting-started-with-Nordic-Thingy-52-Iot-Sensor-Kit
[55]:https://www.nordicsemi.com/eng/Products/Nordic-mobile-Apps/Nordic-Thingy-52-App
[56]:http://infocenter.nordicsemi.com/index.jsp?topic=%2Fcom.nordic.infocenter.gs%2Fdita%2Fgs%2Fgs.html
[57]:https://www.arm.com/products/processors/cortex-m/cortex-m4-processor.php
[58]:https://www.nordicsemi.com/eng/Products/Nordic-mobile-Apps/nRF-Connect-for-mobile-previously-called-nRF-Master-Control-Panel
[59]:https://www.nordicsemi.com/eng/Products/Nordic-mobile-Apps/nRF-Toolbox-App
[60]:https://blog.jabra.com/whats-nfc-and-why-should-you-care/
[61]:https://en.wikipedia.org/wiki/Scatternet
[62]:https://en.wikipedia.org/wiki/Piconet
[63]:http://altbeacon.org/
[64]:https://bkon.com/resources/physical-web-browsers/
[65]:https://bkon.com/products/physical-web-platform/
[66]:http://www.differencebetween.net/technology/difference-between-wibree-and-bluetooth/
[67]:https://en.wikipedia.org/wiki/List_of_Bluetooth_profiles#Serial_Port_Profile_.28SPP.29
[68]:https://learn.adafruit.com/introduction-to-bluetooth-low-energy/gatt#services
[69]:https://learn.adafruit.com/introduction-to-bluetooth-low-energy/gatt#characteristics
[70]:https://devzone.nordicsemi.com/tutorials/5/
[71]:https://www.adafruit.com/product/3406
[72]:https://learn.adafruit.com/introduction-to-bluetooth-low-energy/gap
[73]:https://learn.adafruit.com/introduction-to-bluetooth-low-energy/gatt#profiles
[74]:https://raspberrypi.stackexchange.com/questions/40839/sap-error-on-bluetooth-service-status
[75]:https://www.cnet.com/how-to/how-to-setup-bluetooth-on-a-raspberry-pi-3/
[76]:http://lifehacker.com/everything-you-need-to-set-up-bluetooth-on-the-raspberr-1768482065
[77]:http://linuxcommand.org/man_pages/hcitool1.html
[78]:https://www.element14.com/community/docs/DOC-81266/l/setting-up-bluetooth-on-the-raspberry-pi-3
[79]:https://www.jaredwolff.com/blog/get-started-with-bluetooth-low-energy/
[80]:https://www.bluetooth.com/specifications/gatt/services
[81]:http://www.amd.e-technik.uni-rostock.de/ma/gol/lectures/wirlec/bluetooth_info/l2cap.html
[82]:https://blog.bluetooth.com/bluetooth-technology-protecting-your-privacy
[83]:https://medium.com/@kbabcockuf/bridging-the-gap-bluetooth-le-security-aab27232a767
[84]:https://devzone.nordicsemi.com/question/43670/how-to-distinguish-between-random-and-public-gap-addresses/
[85]:http://csrc.nist.gov/publications/drafts/800-121/sp800_121_r2_draft.pdf
[86]:https://en.wikipedia.org/wiki/MAC_address
[87]:https://github.com/mikeryan/btcrack
[88]:https://github.com/mikeryan/crackle
[89]:https://penturalabs.wordpress.com/2013/09/04/bluetooth-sniffing-why-bother/
[90]:http://www.eetimes.com/document.asp?doc_id=1228130
[91]:https://www.digitalocean.com/community/tutorials/how-to-use-systemctl-to-manage-systemd-services-and-units#unit-management
[92]:https://askubuntu.com/questions/804946/systemctl-how-to-unmask
[93]:https://www.bluetooth.com/develop-with-bluetooth/developer-resources-tools/developer-kits/secure-gateway-kit
[94]:https://www.bluetooth.com/develop-with-bluetooth/developer-resources-tools/developer-kits/secure-gateway-kit/secure-gateway-kit-thank-you
[95]:https://www.bluetooth.com/develop-with-bluetooth/developer-resources-tools/developer-kits
[96]:
[97]:
[98]:
[99]:
[100]:
